var zgassembler;(()=>{"use strict";var e={735:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CompileOption=void 0,t.CompileOption=class{constructor(){this.index=0}GetCurrent(){return this.allLines[this.index]}GetLine(e){return this.allLines[e]}ReplaceLine(e,t){this.allLines[t]=e}}},581:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Config=void 0;class s{static ReadConfigJson(e){if(s.ProjectSetting=JSON.parse(e),"string"!=typeof s.ProjectSetting.platform&&(s.ProjectSetting.platform="6502"),"boolean"!=typeof s.ProjectSetting.intellisense&&(s.ProjectSetting.intellisense=!0),"boolean"!=typeof s.ProjectSetting.outOfRangeWarning&&(s.ProjectSetting.outOfRangeWarning=!0),"string"!=typeof s.ProjectSetting.entry&&(s.ProjectSetting.entry=""),"number"!=typeof s.ProjectSetting.compileTimes&&(s.ProjectSetting.compileTimes=2),"string"!=typeof s.ProjectSetting.outputEntryFile&&(s.ProjectSetting.outputEntryFile=""),"string"!=typeof s.ProjectSetting.outputSingleFile&&(s.ProjectSetting.outputSingleFile=""),"boolean"!=typeof s.ProjectSetting.copyToClipboard&&(s.ProjectSetting.copyToClipboard=!1),s.ProjectSetting.includes instanceof Array){let e=!0;for(let t=0;t<s.ProjectSetting.includes.length;t++)"string"!=typeof s.ProjectSetting.includes[t]&&(e=!1);e||(s.ProjectSetting.includes=["**/*.asm"])}else s.ProjectSetting.includes=["**/*.asm"];if(s.ProjectSetting.excludes instanceof Array){let e=!0;for(let t=0;t<s.ProjectSetting.excludes.length;t++)"string"!=typeof s.ProjectSetting.excludes[t]&&(e=!1);e||(s.ProjectSetting.excludes=[])}else s.ProjectSetting.excludes=[]}}t.Config=s,s.FileExtension={scheme:"file",language:"zg-assembly",extension:"asm"},s.ConfigFile="project-settings.json",s.CommonSplit="/",s.ExtensionCommandNames={ShowLabelTree:"zg-assembly.showLabelTree",CompliteThis:"zg-assembly.compliteThis",CompliteMain:"zg-assembly.compliteMain"},s.InProject=!0,s.ProjectDefaultSetting={platform:"6502",intellisense:!0,outOfRangeWarning:!0,entry:"main.asm",compileTimes:2,outputEntryFile:"",outputSingleFile:"",copyToClipboard:!1,includes:["**/*.asm"],excludes:[]},s.ProjectSetting={platform:"6502",intellisense:!0,outOfRangeWarning:!0,entry:"main.asm",compileTimes:2,outputEntryFile:"",outputSingleFile:"",copyToClipboard:!1,includes:["**/*.asm"],excludes:[]}},754:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Enviroment=void 0;const n=s(200),i=s(185),o=s(603);t.Enviroment=class{constructor(){this.fileIndex=-1,this.compileTime=-1,this.allLabel={global:new Map,local:new Map,nameless:new Map},this.allMacro=new Map,this.allDataGroup=new Map,this.fileLabel={global:new Map},this.fileMacros=new Map,this.labelTree={global:new Map,local:new Map},this.address={base:0,org:-1,offset:0},this.compileResult=new o.CompileResult,this.allLine=new Map,this.allFiles={fileToIndex:new Map,indexToFile:[]},this.highlightRanges=new Map}AddMacro(e){this.allMacro.set(e.name.text,e);const t=this.fileMacros.get(e.fileIndex)??new Set;t.add(e.name.text),this.fileMacros.set(e.fileIndex,t)}ClearFile(e){this.allLine.delete(e),this.highlightRanges.set(e,[]),this.allLabel.nameless.delete(e),this.allLabel.local.delete(e),this.labelTree.local.delete(e);const t=this.fileLabel.global.get(e);t&&(t.forEach((t=>{this.ClearGlobalLabelTree(e,t)})),this.fileLabel.global.set(e,new Set));let s=this.fileMacros.get(e);s&&(s.forEach((e=>{this.allMacro.delete(e)})),this.fileMacros.set(e,new Set)),this.highlightRanges.delete(e)}ClearGlobalLabelTree(e,t){let s=this.labelTree.global.get(t);if(s)if(0===s.child.size){this.labelTree.global.delete(t),this.allLabel.global.delete(t),this.allDataGroup.delete(t);let n=this.labelTree.global.get(s.parent);n&&(n.child.delete(t),this.ClearGlobalLabelTree(e,s.parent))}else{const s=this.allLabel.global.get(t),n=this.fileLabel.global.get(e);s&&n&&(s.type=i.LabelType.None)}}GetFileIndex(e,t=!0){e=n.FileUtils.ArrangePath(e);let s=this.allFiles.fileToIndex.get(e);return void 0===s&&(s=-1,t&&(s=this.allFiles.fileToIndex.size,this.allFiles.fileToIndex.set(e,s),this.allFiles.indexToFile[s]=e)),s}GetFilePath(e){return this.allFiles.indexToFile[e]}SearchLine(e,t){const s=this.allLine.get(e);if(s)return s[t]}SetRange(e){const t=this.fileIndex;let s=this.highlightRanges.get(t);s||(s=[],this.highlightRanges.set(t,s)),s.push(e)}GetRange(e,t){const s=this.highlightRanges.get(e);if(s)for(let e=0;e<s.length;e++){const n=s[e];if(!(t<n.startLine||t>n.endLine))return n}}ClearAll(){this.address.org=-1,this.address.base=0,this.address.offset=0,this.allLabel.global.clear(),this.allLabel.local.clear(),this.allLabel.nameless.clear(),this.allMacro.clear(),this.allDataGroup.clear(),this.allLine.clear(),this.compileResult.ClearAll(),this.highlightRanges.clear(),this.fileLabel.global.clear(),this.fileMacros.clear()}}},828:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExpressionUtils=t.PriorityType=void 0;const n=s(521),i=s(738),o=s(963),r=s(185),a=s(642),d=s(366),l=s(581),c=/((?<!\\)")|\(|\)|\[|\]|\~|\!=|==|\!|\>\>|\>=|\<=|\<\<|\>|\<|=|\+|\-|\*|\/|%|&&|&|\|\||\||\^|\$(?![0-9a-fA-F])/g;var p;!function(e){e[e.Level_0_Sure=-1]="Level_0_Sure",e[e.Level_1_Label=0]="Level_1_Label",e[e.Level_2_Address=1]="Level_2_Address",e[e.Level_3_CharArray=2]="Level_3_CharArray",e[e.Level_4_Brackets=3]="Level_4_Brackets",e[e.Level_5=4]="Level_5",e[e.Level_6=5]="Level_6",e[e.Level_7=6]="Level_7",e[e.Level_8_Shift=7]="Level_8_Shift",e[e.Level_9_Confident1=8]="Level_9_Confident1",e[e.Level_10_Confident2=9]="Level_10_Confident2",e[e.Level_11_And=10]="Level_11_And",e[e.Level_12_Eor=11]="Level_12_Eor",e[e.Level_13_Or=12]="Level_13_Or",e[e.Level_14_AndAnd=13]="Level_14_AndAnd",e[e.Level_15_OrOr=14]="Level_15_OrOr",e[e.Level_16_Brackets=15]="Level_16_Brackets"}(p||(t.PriorityType=p={}));class m{static Initialize(){m.AddPriority(p.Level_4_Brackets,"(",")"),m.AddPriority(p.Level_6,"*","/","%"),m.AddPriority(p.Level_7,"+","-"),m.AddPriority(p.Level_8_Shift,"<<",">>"),m.AddPriority(p.Level_9_Confident1,">","<",">=","<="),m.AddPriority(p.Level_10_Confident2,"!=","=="),m.AddPriority(p.Level_11_And,"&"),m.AddPriority(p.Level_12_Eor,"^"),m.AddPriority(p.Level_13_Or,"|"),m.AddPriority(p.Level_14_AndAnd,"&&"),m.AddPriority(p.Level_15_OrOr,"||"),m.AddPriority(p.Level_16_Brackets,"[","]")}static AddPriority(e,...t){for(let s=0;s<t.length;s++)m.onlyOnePriority.set(t[s],e)}static SplitAndSort(e){let t=m.SplitExpression(e);if(!t.success)return;let s=m.LexerSort(t.parts);return t.success?{parts:s.parts,stringIndex:s.stringIndex,stringLength:t.stringLength}:void 0}static CheckLabels(e,...t){let s=!1;for(let i=0;i<t.length;i++){const d=t[i].parts;for(let t=0;t<d.length;t++){const i=d[t];if(i.type===p.Level_1_Label){const t=r.LabelUtils.FindLabel(i.token,e);if(t)switch(t.type){case r.LabelType.Label:i.highlightType=o.HighlightType.Label;break;case r.LabelType.Defined:i.highlightType=o.HighlightType.Defined}else{const e=n.Localization.GetMessage("Label {0} not found",i.token.text);a.MyDiagnostic.PushException(i.token,e),s=!0}}}}return s}static GetValue(e,t){const s={success:!0,value:0},i=m.CheckLabelAndGetValue(e,t);if(!i)return s.success=!1,s;const o=e=>{if(!(e<0||e>=i.length))return i[e]};let r=-1;for(let t=0;t<i.length;t++){r++;let d=i[t];if("number"!=typeof d)switch(d){case"(!)":case"(-)":case"(>)":case"(<)":case"(~)":const l=o(t-1);if(void 0===l){s.success=!1;const t=n.Localization.GetMessage("Expression error");a.MyDiagnostic.PushException(e[r].token,t);break}switch(d){case"(!)":d=0!==l?1:0;break;case"(-)":d=-l;break;case"(>)":d=(65280&l)>>8;break;case"(<)":d=255&l;break;case"(~)":d=~l}i[t]=d,i.splice(t-1,1),t-=1;break;default:const c=o(t-2),p=o(t-1);if(void 0===c||void 0===p){s.success=!1;const t=n.Localization.GetMessage("Expression error");a.MyDiagnostic.PushException(e[r].token,t);break}switch(d){case"*":d=c*p;break;case"/":d=c/p;break;case"%":d=c%p;break;case"+":d=c+p;break;case"-":d=c-p;break;case"<<":d=c<<p;break;case">>":d=c>>>p;break;case"==":d=c===p?1:0;break;case"!=":d=c!==p?1:0;break;case"&":d=c&p;break;case"^":d=c^p;break;case"|":d=c|p;break;case"&&":d=c&&p;break;case"||":d=c||p;break;case">":d=c>p?1:0;break;case">=":d=c>=p?1:0;break;case"<":d=c<p?1:0;break;case"<=":d=c<=p?1:0}i[t]=d,i.splice(t-2,2),t-=2}}return s.success&&(s.value=i[0]),s}static GetStringValue(e,t){const s={success:!0,values:[]};s.values.length=e.stringLength,t?.macro&&m.CheckExpressionMacro(e,t.macro);const n=e.stringIndex;if(n<0){s.values.length=1;const n=m.GetValue(e.parts,t);s.success=n.success,n.success&&(s.values[0]=n.value)}else for(let i=0;i<e.stringLength;i++){const r=d.Utils.DeepClone(e.parts);r[n]={token:e.parts[n].token.Copy(),value:e.parts[n].chars[i],type:p.Level_0_Sure,highlightType:o.HighlightType.Number};const a=m.GetValue(r,t);if(!a.success){s.success=a.success;break}s.values[i]=a.value}return s}static CombineExpressionPart(e){let t={start:e[0].token.start,end:e[0].token.start+e[0].token.length};for(let s=1;s<e.length;++s){const n=e[s];n.token.start<t.start&&(t.start=n.token.start);let i=n.token.start+n.token.text.length;i>t.end&&(t.end=i)}let s=e[0].token.Copy();return s.start=t.start,s.text=" ",s.text=s.text.repeat(t.end-t.start),s}static SplitExpression(e){const t={success:!0,parts:[],stringIndex:-1,stringLength:0};if(r.LabelUtils.namelessLabelRegex.test(e.text))return t.parts.push({token:e,type:p.Level_1_Label,value:0,highlightType:o.HighlightType.Label}),t;const s=e.Split(c,{saveToken:!0});let i,d=!0;const l=()=>i={type:p.Level_1_Label,token:{},value:0,highlightType:o.HighlightType.None};l();let h=-1;e:for(let o=0;o<s.length;++o)if(i.token=s[o],!(i.token.isEmpty||h>0&&'"'!==i.token.text)){switch(i.token.text){case'"':if(h<0){h=i.token.start;continue}switch(i.token=e.Substring(h-e.start+1,i.token.start-h-1),i.token.text.length){case 0:const e=n.Localization.GetMessage("Expression error");a.MyDiagnostic.PushException(i.token,e),t.success=!1;break e;case 1:i.type=p.Level_0_Sure,i.value=i.token.text.charCodeAt(0),0===t.stringLength&&(t.stringLength=1);break;default:i.type=p.Level_3_CharArray,i.chars=[];for(let e=0;e<i.token.text.length;e++)i.chars[e]=i.token.text.charCodeAt(e);t.stringLength<i.token.text.length&&(t.stringLength=i.token.text.length)}h=-1,d=!1;break;case"(":if(!d){t.success=!1;break}d=!0,i.type=m.onlyOnePriority.get(i.token.text);break;case")":case"]":if(d){t.success=!1;break}d=!1,i.type=m.onlyOnePriority.get(i.token.text);break;case"[":if(d){t.success=!1;break}d=!0,i.type=m.onlyOnePriority.get(i.token.text);break;case">":case"<":case"-":if(d){i.type=p.Level_5,d=!0;break}d=!0,i.type=m.onlyOnePriority.get(i.token.text);break;case"!":case"~":if(!d){t.success=!1;break}i.type=p.Level_5,d=!0;break;case"*":case"$":if(!d){d=!0,i.type=m.onlyOnePriority.get(i.token.text);break}i.type=p.Level_2_Address,d=!1;break;case"+":case"/":case"<<":case">>":case"%":case"&":case"^":case"|":case">=":case"<=":case"!=":case"==":case"&&":case"||":if(d){t.success=!1;break}i.type=m.onlyOnePriority.get(i.token.text),d=!0;break;case"=":const s=n.Localization.GetMessage("Expression error");a.MyDiagnostic.PushException(i.token,s),t.success=!1;break;default:if(!d){t.success=!1;break}d=!1}if(!t.success){const e=n.Localization.GetMessage("Expression error");a.MyDiagnostic.PushException(i.token,e);break}i.type!==p.Level_3_CharArray&&(i.token=i.token.Trim()),t.parts.push(i),l()}if(t.success&&d){const e=n.Localization.GetMessage("Expression error");a.MyDiagnostic.PushException(t.parts[t.parts.length-1].token,e),t.success=!1}return t}static LexerSort(e){const t={success:!0,parts:[],stringIndex:-1},s=[];for(let i=0;i<e.length;i++){const o=e[i];switch(o.type){case p.Level_0_Sure:t.parts.push(o);break;case p.Level_3_CharArray:if(t.stringIndex>=0){const e=n.Localization.GetMessage("Expression error");return a.MyDiagnostic.PushException(o.token,e),t.success=!1,t}t.stringIndex=t.parts.length,t.parts.push(o);break;case p.Level_1_Label:case p.Level_2_Address:const e=m.GetNumber(o.token.text);e.success&&(o.value=e.value,o.type=p.Level_0_Sure),t.parts.push(o);break;case p.Level_4_Brackets:if("("===o.token.text)s.push(o);else{for(;s.length>0&&"("!==s[s.length-1].token.text;){const e=s.pop();t.parts.push(e)}if(0===s.length||"("!==s[s.length-1].token.text){const e=n.Localization.GetMessage("Expression error");a.MyDiagnostic.PushException(o.token,e),t.success=!1;break}s.pop()}break;case p.Level_16_Brackets:if("["===o.token.text)s.push(o);else{for(;s.length>0&&"["!==s[s.length-1].token.text;){const e=s.pop();t.parts.push(e)}if(0===s.length||"["!==s[s.length-1].token.text){const e=n.Localization.GetMessage("Expression error");a.MyDiagnostic.PushException(o.token,e),t.success=!1;break}t.parts.push(s.pop())}break;default:for(;s.length>0&&o.type>=s[s.length-1].type;){const e=s.pop();if(!e)break;if(!(o.type>=e.type&&e.type!==p.Level_4_Brackets)){s.push(e);break}t.parts.push(e)}s.push(o)}if(!t.success)break}for(;;){let e=s.pop();if(!e)break;if(e.type===p.Level_4_Brackets||e.type===p.Level_16_Brackets){const s=n.Localization.GetMessage("Expression error");a.MyDiagnostic.PushException(e.token,s),t.success=!1;break}t.parts.push(e)}return t}static CheckLabelAndGetValue(e,t){const s=[];let o=i.Compiler.enviroment.compileTime<l.Config.ProjectSetting.compileTimes-1;void 0!==t?.tryValue&&(o=t.tryValue);let d=!0;const c=(e,t)=>{e.value=t,e.type=p.Level_0_Sure,s.push(e.value)};for(let l=0;l<e.length;l++){const h=e[l];switch(h.type){case p.Level_0_Sure:s.push(h.value);break;case p.Level_1_Label:const e=m.GetNumber(h.token.text);if(e.success){c(h,e.value);break}const l=r.LabelUtils.FindLabel(h.token,{macro:t?.macro});if(void 0===l?.value){if(d=!1,!o){const e=n.Localization.GetMessage("Label {0} not found",h.token.text);a.MyDiagnostic.PushException(h.token,e)}}else c(h,l.value);break;case p.Level_2_Address:switch(h.token.text){case"*":c(h,i.Compiler.enviroment.address.org);break;case"$":c(h,i.Compiler.enviroment.address.base)}break;case p.Level_3_CharArray:const u=n.Localization.GetMessage("Expression error");a.MyDiagnostic.PushException(h.token,u),d=!1;break;case p.Level_5:s.push("("+h.token.text+")");break;default:s.push(h.token.text)}}if(d)return s}static GetNumber(e){const t=/(^(?<hex>\$[0-9a-fA-F]+)$)|(^(?<decimal>\-?[0-9]+(\.[0-9]+)?)$)|(^(?<bin>\@[01]+)$)/.exec(e),s={success:!!t,value:0};return t?.groups?.hex?(e=e.substring(1),s.value=parseInt(e,16)):t?.groups?.decimal?s.value=Number(e):t?.groups?.bin&&(e=e.substring(1),s.value=parseInt(e,2)),s}static CheckExpressionMacro(e,t){for(let s=0;s<e.parts.length;s++){const n=e.parts[s];if(n.type!==p.Level_1_Label)continue;const i=t.params.get(n.token.text);i&&(i.values.length>1?(n.chars=i.values,e.stringIndex=s,e.stringLength=i.values.length):(n.value=i.values[0],n.type=p.Level_0_Sure))}}}t.ExpressionUtils=m,m.onlyOnePriority=new Map},200:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FileUtils=void 0;const n=s(581);class i{static Implement(e){e.ReadFile&&(i.ReadFile=e.ReadFile),e.SaveFile&&(i.SaveFile=e.SaveFile),e.GetFolderFiles&&(i.GetFolderFiles=e.GetFolderFiles),e.PathType&&(i.PathType=e.PathType),e.ShowMessage&&(i.ShowMessage=e.ShowMessage)}static StringToBytes(e){return(new TextEncoder).encode(e)}static BytesToString(e){return(new TextDecoder).decode(e)}static Combine(...e){const t=[];for(let s=0;s<e.length;++s){const n=e[s].split(/[\\\/]/g);for(let e=0;e<n.length;++e)switch(n[e]){case"..":t.pop();break;case".":break;default:t.push(n[e])}}return t.join(n.Config.CommonSplit)}static async GetPathFolder(e){let t=await i.PathType(e);if("none"===t)return"";let s=e.split(/[\\\/]/g);return"file"===t&&s.splice(s.length-1,1),s.join(n.Config.CommonSplit)}static async GetFileName(e){if("file"!==await i.PathType(e))return"";let t=e.split(/[\\\/]/g);return t[t.length-1]}static ArrangePath(e){return e.toLocaleLowerCase().split(/[\\\/]/g).join(n.Config.CommonSplit)}}t.FileUtils=i},185:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LabelUtils=t.LabelScope=t.LabelType=void 0;const n=s(521),i=s(738),o=s(828),r=s(642);var a,d;!function(e){e[e.None=0]="None",e[e.Variable=1]="Variable",e[e.Defined=2]="Defined",e[e.Label=3]="Label",e[e.DataGroup=4]="DataGroup",e[e.Parameter=5]="Parameter",e[e.IndefiniteParam=6]="IndefiniteParam"}(a||(t.LabelType=a={})),function(e){e[e.Global=0]="Global",e[e.Local=1]="Local",e[e.Nameless=2]="Nameless"}(d||(t.LabelScope=d={}));class l{static get namelessLabelRegex(){return new RegExp(/^((?<plus>\+)|(?<minus>\-))+$/g)}static CreateCommonLabel(e,t){if(l.namelessLabelRegex.exec(e.text)){if(void 0!==t?.ableNameless&&!t?.ableNameless){const t=n.Localization.GetMessage("Label {0} illegal");return void r.MyDiagnostic.PushException(e,t)}const s=l.InsertNamelessLabel(e,t?.comment);return t?.comment&&(s.comment=t.comment),s}let s=!t?.macro;if(!l.CheckIllegal(e.text,s)){const t=n.Localization.GetMessage("Label {0} illegal",e.text);return void r.MyDiagnostic.PushException(e,t)}if(t?.macro){if(t.macro.labels.has(e.text)||t.macro.name.text===e.text){const t=n.Localization.GetMessage("Label {0} is already defined",e.text);return void r.MyDiagnostic.PushException(e,t)}const s={type:a.Label,scope:d.Global,token:e,fileIndex:0};return t.macro.labels.set(e.text,s),s}const i=l.SplitLabel(e);return t?.comment&&i&&(i.comment=t.comment),i}static FindLabel(e,t){if(!e||e.isEmpty)return;const s=l.namelessLabelRegex.exec(e.text);let c,p=i.Compiler.enviroment.fileIndex;if(void 0!==t?.fileIndex&&(p=t.fileIndex),!s){if(e.text.includes(":")){const t=e.Split(/\:/g);if(t.length>2){const t=n.Localization.GetMessage("Label {0} illegal");return void r.MyDiagnostic.PushException(e,t)}const s=i.Compiler.enviroment.allDataGroup.get(t[0].text);if(!s)return;let l=0;if(!t[2].isEmpty){const e=o.ExpressionUtils.GetNumber(t[2].text);if(!e.success){const e=n.Localization.GetMessage("Label {0} not found",t[2].text);return void r.MyDiagnostic.PushException(t[2],e)}l=e.value}const c=s.FindData(t[1].text,l);if(!c)return;return{token:c.token,type:a.DataGroup,value:c.index,scope:d.Global,fileIndex:0}}if(t?.macro){const s=t.macro.params.get(e.text);if(s)return s.label;const n=t.macro.labels.get(e.text);if(n)return n}return c=(e.text.startsWith(".")?d.Local:d.Global)===d.Global?i.Compiler.enviroment.allLabel.global.get(e.text):i.Compiler.enviroment.allLabel.local.get(p)?.get(e.text),c}{let t=s[0].length;const n=i.Compiler.enviroment.allLabel.nameless.get(p);if(!n)return;if(s.groups?.minus){const s=n.upLabels;t=-t;for(let n=0;n<s.length;++n)if(s[n].count==t&&s[n].token.line<=e.line)return s[n]}else{const s=n.downLabels;for(let n=0;n<s.length;++n)if(s[n].token.length==t&&s[n].token.line>=e.line)return s[n]}}}static CheckIllegal(e,t){if(t){if(/(^\d)|\s|\,|\+|\-|\*|\/|\>|\<|\=|\!|\~|:|#|&|\||%|\$|"/g.test(e))return!1}else if(/(^\d)|\s|\,|\+|\-|\*|\/|\>|\<|\=|\!|\~|:|#|&|\||%|\$|"|\./g.test(e))return!1;return!0}static RemoveColon(e){return e.text.endsWith(":")?e.Substring(0,e.length-1):e}static InsertNamelessLabel(e,t){const s=i.Compiler.enviroment.fileIndex,n=i.Compiler.enviroment.allLabel.nameless.get(s)??{upLabels:[],downLabels:[]},o="+"===e.text[0],r={type:a.Label,fileIndex:s,scope:d.Nameless,count:o?e.length:-e.length,token:e,comment:t};let l,c=0;if(o)for(l=n.downLabels;c<l.length&&!(l[c].token.line>e.line);++c);else for(l=n.upLabels;c<l.length&&!(l[c].token.line<e.line);++c);return l.splice(c,0,r),i.Compiler.enviroment.allLabel.nameless.set(s,n),r}static SplitLabel(e){const t=e.Split(/\./g);let s="";t[0].isEmpty&&(t.splice(0,1),s+=".");const o=e.text.startsWith(".")?d.Local:d.Global;let l,c,p="",m=new Set;const h=i.Compiler.enviroment.fileIndex;o===d.Global?(l=i.Compiler.enviroment.allLabel.global,c=i.Compiler.enviroment.labelTree.global,m=i.Compiler.enviroment.fileLabel.global.get(h),m||(m=new Set,i.Compiler.enviroment.fileLabel.global.set(h,m))):(l=i.Compiler.enviroment.allLabel.local.get(h),l||(l=new Map,i.Compiler.enviroment.allLabel.local.set(h,l)),c=i.Compiler.enviroment.labelTree.local.get(h),c||(c=new Map,i.Compiler.enviroment.labelTree.local.set(h,c)));const u=t.length-1;let g,C;for(let h=0;h<t.length;++h){if(0!==h&&(s+="."),t[h].isEmpty){const t=n.Localization.GetMessage("Label {0} illegal",e.text);return void r.MyDiagnostic.PushException(e,t)}if(s+=t[h].text,C=l.get(s),h===u){if(C?.type===a.Defined||C?.type===a.Label){let t=n.Localization.GetMessage("Label {0} is already defined",e.text);return void r.MyDiagnostic.PushException(e,t)}if(C?.type===a.Variable)return C;C={token:e.Copy(),scope:o,type:a.Defined,fileIndex:i.Compiler.enviroment.fileIndex},C.token.text=s,l.set(s,C)}else l.has(s)||(C={token:e.Copy(),scope:o,type:a.None,fileIndex:i.Compiler.enviroment.fileIndex},C.token.text=s,l.set(s,C));p&&g&&g.child.add(s),g=c.get(s),g||(g={parent:"",child:new Set},c.set(s,g)),g.parent=p,o===d.Global&&m.add(s),p=s}return C}}t.LabelUtils=l},783:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Macro=void 0,t.Macro=class{constructor(){this.labels=new Map,this.params=new Map,this.lines=[],this.lineOffset=0}}},642:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MyDiagnostic=void 0;const n=s(738);class i{static get hasError(){return 0!==i.allErrors.size}static PushException(e,t,s){void 0===s&&(s=n.Compiler.enviroment.fileIndex);let o=i.allErrors.get(s);o||(o=new Map,i.allErrors.set(s,o)),o.set(e.line,{word:e,msg:t})}static GetExceptions(e){const t=[];if(void 0!==e){const s=i.allErrors.get(e);s&&s.forEach(((s,i)=>{t.push({filePath:n.Compiler.enviroment.GetFilePath(e),line:i,start:s.word.start,length:s.word.text.length,message:s.msg})}))}else i.allErrors.forEach(((e,s)=>{e.forEach(((e,i)=>{t.push({filePath:n.Compiler.enviroment.GetFilePath(s),line:e.word.line,start:e.word.start,length:e.word.text.length,message:e.msg})}))}));return t}static PushWarning(e,t,s){void 0===s&&(s=n.Compiler.enviroment.fileIndex);let o=i.allWarning.get(s);o||(o=new Map,i.allWarning.set(s,o)),o.set(e.line,{word:e,msg:t})}static GetWarnings(){const e=[];return i.allWarning.forEach(((t,s)=>{t.forEach(((t,i)=>{e.push({filePath:n.Compiler.enviroment.GetFilePath(s),line:i,start:t.word.start,length:t.word.text.length,message:t.msg})}))})),e}static ClearFileExceptions(e){i.allErrors.set(e,new Map),i.allWarning.set(e,new Map)}static ClearAll(){i.allErrors.clear(),i.allWarning.clear()}}t.MyDiagnostic=i,i.allErrors=new Map,i.allWarning=new Map},382:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Token=void 0;class s{constructor(e,t){this.text=e,this.start=t?.start??0,this.line=t?.line??0}get length(){return this.text.length}get isEmpty(){return""===this.text.trim()}Copy(){return new s(this.text,{start:this.start,line:this.line})}Split(e,t){let s,n=[],i=0;if(null==t?.count){for(;s=e.exec(this.text);)n.push(this.Substring(i,s.index-i)),i=s.index+s[0].length,t?.saveToken&&n.push(this.Substring(s.index,s[0].length));let o=this.Substring(i);n.push(o)}else{n.length=t.count+1;let o=0;for(;null!=(s=e.exec(this.text))&&o<t.count;)n[o]=this.Substring(i,s.index-i),i=s.index+s[0].length,o++,t?.saveToken&&n.push(this.Substring(s.index,s[0].length));for(;o<=t.count;)n[o]=this.Substring(i),i+=n[o].length,o++}return n}Substring(e,t){let s;s=null==t?void 0:e+t;let n=this.Copy();return n.text=n.text.substring(e,s),n.start=this.start+e,n}Trim(){const e=/^\s+/.exec(this.text),t=this.Copy();return e&&(t.start+=e[0].length),t.text=this.text.trim(),t}}t.Token=s},366:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Utils=void 0;class s{static GetHashcode(...e){let t=0;for(let n=0;n<e.length;++n){const i=e[n];switch(typeof i){case"string":for(var s=0;s<i.length;++s)t=Math.imul(31,t)+i.charCodeAt(s)|0;break;case"number":t=Math.imul(31,t)+i|0}}return t}static TransformRegex(e){return e.replace(".","\\.").replace("[","\\[").replace("]","\\]").replace(",","\\,").replace("(","\\(").replace(")","\\)").replace("-","\\-").replace("+","\\+")}static GetNumberByteLength(e){let t=0;do{e>>>=8,t++}while(0!==e);return t}static SetAddElement(e,...t){for(let s=0;s<t.length;s++)e.add(t[s])}static DeepClone(e){const t=new e.constructor;for(const n in e)if(e.hasOwnProperty(n))switch(s.GetType(e[n])){case"Object":case"Array":t[n]=s.DeepClone(e[n]);break;case"Map":const i=e[n],o=t[n];for(const e of i.keys())o.set(e,s.DeepClone(i.get(e)));break;default:t[n]=e[n]}return t}static GetType(e){return Object.prototype.toString.call(e).slice(8,-1)}static ConvertValue(e){let t={bin:"",dec:"",hex:""},s=e;do{let e=(255&s).toString(2),n=e.padStart(8,"0").split("");n.splice(4,0," "),e=n.join(""),t.bin=" "+e+t.bin,s>>>=8}while(0!=s);return t.bin=t.bin.substring(1),t.dec=e.toString(),t.hex=e.toString(16).toUpperCase(),t}}t.Utils=s},126:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Command=void 0;const n=s(642),i=s(521),o=s(770),r=s(958),a=s(590),d=s(349),l=s(717),c=s(970),p=s(127),m=s(226),h=s(134),u=s(153),g=s(607),C=s(877);class x{static Initialize(){x.AddCommand(d.DefinedCommand,u.Original,u.Base,C.EnumCommand,a.DBCommand,a.DWCommand,a.DLCommand,l.HexCommand,p.Include,p.Incbin,c.IfConfident,c.IfDefConfident,c.IfNDefConfident,m.MacroCommand,h.MsgCommand,h.ErrorCommand,g.RepeatCommand)}static async AnalyseFirst(e){const t=await x.AnalyseCommand(e);t?.com.AnalyseFirst&&await t.com.AnalyseFirst(e)}static async AnalyseSecond(e){const t=e.GetCurrent().command.text.toUpperCase(),s=x.commandMap.get(t);s?.AnalyseSecond&&await s.AnalyseSecond(e)}static async AnalyseThird(e){const t=e.GetCurrent().command.text.toUpperCase(),s=x.commandMap.get(t);s?.AnalyseThird&&await s.AnalyseThird(e)}static async Compile(e){const t=await x.AnalyseCommand(e);t?.line.label?.Compile(e),t?.com.Compile&&await t.com.Compile(e)}static async AnalyseCommand(e){const t=e.GetCurrent(),s=t.command.text.toUpperCase(),r=x.commandMap.get(s);if(!r){const e=i.Localization.GetMessage("Command {0} Error",t.command.text);return n.MyDiagnostic.PushException(t.command,e),void(t.lineType=o.LineType.Error)}if(r?.end){const t=x.commandMatchOption.get(s);if(e.matchIndex=x.FindNextMatch(e,t),!e.matchIndex)return}if(t.label)if(r.allowLabel)t.label.Analyse();else{const e=i.Localization.GetMessage("Command {0} can not use label",t.command.text);n.MyDiagnostic.PushException(t.label.labelToken,e),t.lineType=o.LineType.Error}return{line:t,com:r}}static FindNextMatch(e,t){const s=[];let r=0,a=e.index,d=!1;for(;a++,!(a>=e.allLines.length);){const n=e.GetLine(a);if(!n||"command"!==n.key)continue;let i=n.command.text.toUpperCase();if(i===t.start||t.sameEnd?.includes(i))r++;else if(i!==t.end)t.rest?.includes(i)&&0===r&&s.push(a);else{if(0===r){d=!0,s.push(a);break}r--}}if(0!==r||!d){const s=e.GetCurrent();s.lineType=o.LineType.Error;const r=i.Localization.GetMessage("Unmatched command {0}",t.start);return n.MyDiagnostic.PushException(s.command,r),void(e.index=e.allLines.length)}return s}static SplitArgument(e,t){const s=x.commandParam.get(e.text.toUpperCase());if(!s){const t=i.Localization.GetMessage("Command {0} Error",e.text);return void n.MyDiagnostic.PushException(e,t)}if(t.isEmpty){if(0!==s.min){const t=i.Localization.GetMessage("Command arguments error");return void n.MyDiagnostic.PushException(e,t)}return[]}const o=r.Analyser.SplitComma(t);if(!(o.length<s.min||void 0!==s.max&&o.length>s.max))return o;{const t=i.Localization.GetMessage("Command arguments error");n.MyDiagnostic.PushException(e,t)}}static MarkLineFinished(e,t,s){for(let n=t;n<=s;n++)e.allLines[n]&&(e.allLines[n].lineType=o.LineType.Ignore)}static AddCommand(...e){for(let t=0;t<e.length;t++){const s=new e[t];x.commandParam.set(s.start.name,{min:s.start.min,max:s.start.max});let n={};s.rest&&(n.rest=[],s.rest.map((e=>{x.commandParam.set(e.name,{min:e.min,max:e.max}),n.rest?.push(e.name)}))),s.sameEnd&&(n.sameEnd=s.sameEnd),s.end&&(x.commandParam.set(s.end,{min:0,max:0}),n.start=s.start.name,n.end=s.end,x.commandMatchOption.set(s.start.name,n)),void 0===s.allowLabel&&(s.allowLabel=!0),x.commandMap.set(s.start.name,s)}}}t.Command=x,x.commandMap=new Map,x.commandParam=new Map,x.commandMatchOption=new Map},590:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DataCommand=t.DLCommand=t.DWCommand=t.DBCommand=void 0;const n=s(828),i=s(770),o=s(521),r=s(642),a=s(738);t.DBCommand=class{constructor(){this.start={name:".DB",min:1},this.AnalyseFirst=d.AnalyseFirst,this.AnalyseThird=d.AnalyseThird}Compile(e){d.Compile(1,e)}},t.DWCommand=class{constructor(){this.start={name:".DW",min:1},this.AnalyseFirst=d.AnalyseFirst,this.AnalyseThird=d.AnalyseThird}Compile(e){d.Compile(2,e)}},t.DLCommand=class{constructor(){this.start={name:".DL",min:1},this.AnalyseFirst=d.AnalyseFirst,this.AnalyseThird=d.AnalyseThird}Compile(e){d.Compile(4,e)}};class d{static AnalyseFirst(e){const t=e.GetCurrent(),s=[];for(let e=0;e<t.arguments.length;e++){const o=n.ExpressionUtils.SplitAndSort(t.arguments[e]);o?s[e]=o:t.lineType=i.LineType.Error}t.tag=s}static AnalyseThird(e){const t=e.GetCurrent().tag;n.ExpressionUtils.CheckLabels(e,...t)}static Compile(e,t){a.Compiler.FirstCompile()&&d.AnalyseFirst(t);const s=t.GetCurrent();s.lineResult.SetAddress(),s.lineType=i.LineType.Finished;const l=s.tag;let c=0;for(let a=0;a<l.length;a++){const d=l[a],p=n.ExpressionUtils.GetStringValue(d,t);if(p.success)for(let t=0;t<p.values.length;t++){const i=s.lineResult.SetResult(p.values[t],c,e);if(i.overflow){const e=o.Localization.GetMessage("Expression result is {0}, but compile result is {1}",p.values[t],i.result),s=n.ExpressionUtils.CombineExpressionPart(d.parts);r.MyDiagnostic.PushWarning(s,e)}c+=e}else s.lineType=i.LineType.None,s.lineResult.result.length+=p.values.length*e,c+=s.lineResult.result.length}s.lineResult.AddAddress()}}t.DataCommand=d},349:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DefinedCommand=void 0;const n=s(828),i=s(185),o=s(738),r=s(770);t.DefinedCommand=class{constructor(){this.start={name:".DEF",min:2,max:2},this.allowLabel=!1}AnalyseFirst(e){const t=e.GetCurrent(),s={},o=i.LabelUtils.CreateCommonLabel(t.arguments[0],{ableNameless:!1,comment:t.comment});s.label=o;const r=n.ExpressionUtils.SplitAndSort(t.arguments[1]);r&&(s.exp=r),t.tag=s}AnalyseThird(e){const t=e.GetCurrent().tag;if(t.exp){if(n.ExpressionUtils.CheckLabels(e,t.exp)||!t.label)return;const s=n.ExpressionUtils.GetValue(t.exp.parts,e);s.success&&(t.label.value=s.value)}}Compile(e){o.Compiler.FirstCompile()&&this.AnalyseFirst(e);const t=e.GetCurrent(),s=t.tag;if(!s.label||!s.exp)return void(t.lineType=r.LineType.Error);const i=n.ExpressionUtils.GetValue(s.exp.parts,e);i.success&&(s.label.value=i.value,t.lineType=r.LineType.Finished)}}},877:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EnumCommand=void 0;const n=s(828),i=s(185),o=s(642),r=s(958),a=s(738),d=s(521),l=s(126);t.EnumCommand=class{constructor(){this.start={name:".ENUM",min:1,max:1},this.end=".ENDE",this.allowLabel=!1}AnalyseFirst(e){this.AnalyseAllLines(e)}AnalyseThird(e){const t=e.GetCurrent().tag;let s;if(t.exp){if(n.ExpressionUtils.CheckLabels(e,t.exp))return;const i=n.ExpressionUtils.GetValue(t.exp.parts);i.success&&(s=i.value)}if(void 0!==s)for(let o=0;o<t.lines.length;o++){const r=t.lines[o];if(!r)continue;if(n.ExpressionUtils.CheckLabels(e,r.expression))break;const a=i.LabelUtils.FindLabel(r.labelToken);if(!a)break;a.value=s;const d=n.ExpressionUtils.GetValue(r.expression.parts,e);if(!d.success)break;s+=d.value}}Compile(e){let t;t=0===a.Compiler.enviroment.compileTime?this.AnalyseAllLines(e):e.GetCurrent();const s=t.tag;let o;if(void 0!==s.startValue)o=s.startValue;else{const t=n.ExpressionUtils.GetValue(s.exp.parts,e);t.success&&(s.startValue=t.value,o=t.value)}if(void 0===o)return;let r=!1;for(let t=0;t<s.lines.length;t++){const d=s.lines[t];if(!d)continue;let l;if(l=0===a.Compiler.enviroment.compileTime?i.LabelUtils.CreateCommonLabel(d.labelToken,{ableNameless:!1}):i.LabelUtils.FindLabel(d.labelToken),r||!l)continue;l.value=o;const c=n.ExpressionUtils.GetValue(d.expression.parts,e);c.success?o+=c.value:r=!0}}AnalyseAllLines(e){const t=e.GetCurrent(),s=e.matchIndex[0],c=e.index+1,p=e.allLines.slice(c,s),m={startValue:void 0,exp:void 0,lines:[]},h=n.ExpressionUtils.SplitAndSort(t.arguments[0]);h&&(m.exp=h),l.Command.MarkLineFinished(e,e.index+1,s),m.lines.length=p.length;for(let e=0;e<p.length;e++){const t=p[e];if(!t)continue;let s;switch(t.key){case"label":case"macro":console.error("不可能是这种行");continue;default:if(s=r.Analyser.SplitComma(t.org,{count:1}),!s||2!==s.length){const e=d.Localization.GetMessage("Command arguments error");o.MyDiagnostic.PushException(t.org,e);continue}}const l=n.ExpressionUtils.SplitAndSort(s[1]);if(l){if(s[0]=s[0].Trim(),a.Compiler.enviroment.compileTime<0){const e=i.LabelUtils.CreateCommonLabel(s[0],{ableNameless:!1,comment:t.comment});e&&(e.type=i.LabelType.Defined,e.comment=t.comment)}m.lines[e]={labelToken:s[0],expression:l}}}return a.Compiler.enviroment.SetRange({type:"enum",key:"",startLine:e.index,endLine:s}),t.tag=m,t}}},717:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HexCommand=void 0;const n=s(642),i=s(521),o=s(770);t.HexCommand=class{constructor(){this.start={name:".HEX",min:1,max:1}}AnalyseFirst(e){this.Analyse(e)}Compile(e){const t=this.Analyse(e);if(!t)return;t.lineResult.SetAddress();const s=t.tag;for(let e=0;e<s.length;e++)t.lineResult.result.push(...this.GetHex(s[e].text));t.lineResult.AddAddress(),t.lineType=o.LineType.Finished}Analyse(e){const t=e.GetCurrent(),s=t.arguments[0];if(!/^[ 0-9a-fA-F]+$/g.test(s.text)){const e=i.Localization.GetMessage("Command arguments error");return n.MyDiagnostic.PushException(s,e),void(t.lineType=o.LineType.Error)}return t.tag=s.Split(/\s+/g),t}GetHex(e){const t=[];for(let s=0;s<e.length;s+=2){const n=parseInt(e.substring(s,s+2),16);t.push(n)}return t}}},970:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IfNDefConfident=t.IfDefConfident=t.IfConfident=void 0;const n=s(828),i=s(185),o=s(738),r=s(770);t.IfConfident=class{constructor(){this.start={name:".IF",min:1,max:1},this.rest=[{name:".ELSEIF",min:1,max:1},{name:".ELSE",min:0,max:0}],this.end=".ENDIF",this.sameEnd=[".IFDEF",".IFNDEF"],this.allowLabel=!1}AnalyseFirst(e){this.Analyse(e)}AnalyseThird(e){const t=e.GetCurrent(),s=t.tag;for(let i=0;i<s.lines.length-1;++i){const o=s.lines[i].exp;o&&n.ExpressionUtils.CheckLabels(e,o)&&(t.lineType=r.LineType.Error)}}Compile(e){const t=this.Analyse(e);if(t.lineType===r.LineType.Error)return;const s=t.tag,i=e.index;for(let t=0;t<s.lines.length-1;t++){const o=s.lines[t];if(".ELSE"===e.allLines[i+o.offsetFirstLine].command.text.toUpperCase()){o.confident=!0;break}const r=n.ExpressionUtils.GetValue(o.exp.parts,{macro:e.macro,tryValue:!1});if(r.success&&r.value){s.lines[t].confident=!0;break}}t.lineType=r.LineType.Finished,d.MarkLineFinished(e,i,s.lines)}Analyse(e){const t=e.GetCurrent(),s=e.matchIndex;let i=0;const o=[".ELSEIF",".ELSE",".ENDIF"];let a=n.ExpressionUtils.SplitAndSort(t.arguments[0]);const d={exp:a,lines:[{offsetFirstLine:0,confident:!1,exp:a}]},l=e.index;for(let c=0;c<s.length;c++){const p=s[c],m=e.GetLine(p),h=o.indexOf(m.command.text.toUpperCase());if(!(h<i)){switch(h){case 0:m.tag={exp:n.ExpressionUtils.SplitAndSort(t.arguments[0])};break;case 1:i=2}m.arguments[0]?(a=n.ExpressionUtils.SplitAndSort(m.arguments[0]),a||(m.lineType=r.LineType.Error)):a=void 0,d.lines.push({offsetFirstLine:p-l,confident:!1,exp:a}),e.GetLine(p).lineType=r.LineType.Finished}}return t.tag=d,t}},t.IfDefConfident=class{constructor(){this.start={name:".IFDEF",min:1,max:1},this.rest=[{name:".ELSE",min:0,max:0}],this.end=".ENDIF",this.sameEnd=[".IF",".IFNDEF"],this.allowLabel=!1}AnalyseFirst(e){a.AnalyseFirst(e)}Compile(e){a.Compile(e,!0)}},t.IfNDefConfident=class{constructor(){this.start={name:".IFNDEF",min:1,max:1},this.rest=[{name:".ELSE",min:0,max:0}],this.end=".ENDIF",this.sameEnd=[".IF",".IFDEF"],this.allowLabel=!1}AnalyseFirst(e){a.AnalyseFirst(e)}Compile(e){a.Compile(e,!1)}};class a{static AnalyseFirst(e){const t=e.GetCurrent(),s=e.matchIndex;let n=0;const i=[".ELSE",".ENDIF"],o=[{offsetFirstLine:0,confident:!1,token:t.arguments[0]}],a=e.index;for(let t=0;t<s.length;t++){const d=s[t],l=e.GetLine(d),c=i.indexOf(l.command.text.toUpperCase());if(!(c<n)){switch(c){case 0:n=1;break;case 1:n=2}o.push({offsetFirstLine:d-a,confident:!1}),e.GetLine(d).lineType=r.LineType.Finished}}return t.tag=o,t}static Compile(e,t){const s=a.AnalyseFirst(e),n=s.tag,l=e.index;for(let s=0;s<n.length-1;s++){const r=n[s];if(".ELSE"===e.GetLine(l+r.offsetFirstLine).command.text.toUpperCase()){r.confident=!0;break}if(!r.token){r.confident=!1;continue}let a;if(a=i.LabelUtils.FindLabel(r.token),a||(a=o.Compiler.enviroment.allMacro.get(r.token.text)),a&&t||!a&&!t){r.confident=!0;break}}s.lineType=r.LineType.Finished,d.MarkLineFinished(e,l,n)}}class d{static MarkLineFinished(e,t,s){for(let n=s.length-2;n>=0;--n){const i=s[n];if(i.confident)continue;const o=t+i.offsetFirstLine,a=t+s[n+1].offsetFirstLine;for(let t=o;t<a;t++)e.allLines[t]&&(e.allLines[t].lineType=r.LineType.Ignore)}}}},127:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Incbin=t.Include=void 0;const n=s(735),i=s(828),o=s(200),r=s(642),a=s(958),d=s(738),l=s(521),c=s(770);t.Include=class{constructor(){this.start={name:".INCLUDE",min:1,max:1}}static GetResult(e,t){const s=e.GetCurrent().tag;d.Compiler.GetLinesResult(s.option,t)}async AnalyseFirst(e){const t=e.GetCurrent(),s=await p.CheckFile(e);if(!s.exsist)return void(t.lineType=c.LineType.Error);const i={orgPath:t.arguments[0],path:s.path,option:new n.CompileOption};t.tag=i}async Compile(e){const t=e.GetCurrent();let s;const i=d.Compiler.enviroment.fileIndex;if(d.Compiler.FirstCompile()){const i=await p.CheckFile(e);if(!i.exsist)return void(t.lineType=c.LineType.Error);s={orgPath:t.arguments[0],path:i.path,option:new n.CompileOption},t.tag=s;const r=await o.FileUtils.ReadFile(s.path),l=o.FileUtils.BytesToString(r);d.Compiler.enviroment.fileIndex=d.Compiler.enviroment.GetFileIndex(s.path),s.option.allLines=a.Analyser.AnalyseText(l,s.path)}else s=t.tag,d.Compiler.enviroment.fileIndex=d.Compiler.enviroment.GetFileIndex(s.path);await d.Compiler.Compile(s.option),d.Compiler.enviroment.fileIndex=i}},t.Incbin=class{constructor(){this.start={name:".INCBIN",min:1,max:3}}async AnalyseFirst(e){await this.CheckFile(e)}async Compile(e){const t=await this.CheckFile(e);if(!t)return;const s=t.tag,n=await o.FileUtils.ReadFile(s.path);t.lineResult.SetAddress();let r=0;if(s.exps[0]){const e=i.ExpressionUtils.GetValue(s.exps[0].parts,{tryValue:!1});e.success&&(r=e.value)}let a=n.length;if(s.exps[1]){const e=i.ExpressionUtils.GetValue(s.exps[1].parts,{tryValue:!1});e.success&&(a=e.value)}t.lineResult.result=[];for(let e=r,s=0;e<n.length&&s<a;++e,++s)t.lineResult.result[s]=n[e];t.lineType=c.LineType.Finished,t.lineResult.AddAddress()}async CheckFile(e){const t=await p.CheckFile(e);if(!t.exsist)return;const s=e.GetCurrent(),n={orgPath:s.arguments[0],path:t.path,exps:[]};let o;return s.arguments[1]&&(o=i.ExpressionUtils.SplitAndSort(s.arguments[1]))&&(n.exps[0]=o),s.arguments[2]&&(o=i.ExpressionUtils.SplitAndSort(s.arguments[2]))&&(n.exps[1]=o),s.tag=n,s}};class p{static async CheckFile(e){const t=e.GetCurrent(),s={exsist:!1,path:""};if(t.arguments[0]=t.arguments[0].Trim(),!t.arguments[0].text.startsWith('"')||!t.arguments[0].text.endsWith('"')){const e=l.Localization.GetMessage("Command arguments error");return r.MyDiagnostic.PushException(t.arguments[0],e),t.lineType=c.LineType.Error,s}const n=t.arguments[0].Substring(1,t.arguments[0].length-2);let i=await o.FileUtils.PathType(n.text);"file"===i&&(s.exsist=!0,s.path=n.text);const a=d.Compiler.enviroment.GetFilePath(d.Compiler.enviroment.fileIndex),p=await o.FileUtils.GetPathFolder(a);if(s.path=o.FileUtils.Combine(p,n.text),i=await o.FileUtils.PathType(s.path),s.exsist="file"===i,!s.exsist){const e=l.Localization.GetMessage("File {0} is not exist",n.text);r.MyDiagnostic.PushException(n,e)}return t.tag={orgPath:n,path:s.path},s}}},226:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MacroCommand=void 0;const n=s(735),i=s(185),o=s(783),r=s(642),a=s(366),d=s(958),l=s(738),c=s(521),p=s(963),m=s(770),h=s(126);t.MacroCommand=class{constructor(){this.start={name:".MACRO",min:1},this.end=".ENDM"}static GetHighlight(e){const t=e.GetCurrent().tag,s=new p.HighlightOption;s.lines=t.lines,s.result=e.result,p.HighlightingProvider.GetHighlight(s),e.index+=t.lines.length}async AnalyseFirst(e){const t=e.GetCurrent();if(!i.LabelUtils.CheckIllegal(t.arguments[0].text,!1)){const e=c.Localization.GetMessage("Label {0} illegal",t.arguments[0].text);return r.MyDiagnostic.PushException(t.arguments[0],e),void(t.lineType=m.LineType.Error)}const s=t.arguments[0];if(i.LabelUtils.FindLabel(s)||l.Compiler.enviroment.allMacro.has(s.text)){const e=c.Localization.GetMessage("Label {0} is already defined",s.text);return r.MyDiagnostic.PushException(t.arguments[0],e),void(t.lineType=m.LineType.Error)}const p=e.matchIndex[0],u=new o.Macro;u.name=t.arguments[0],u.fileIndex=l.Compiler.enviroment.fileIndex,u.comment=t.comment;const g=t.arguments.length-1;for(let e=1;e<t.arguments.length;e++){const s=t.arguments[e].Trim();if(e===g&&s.text.startsWith("...")){const e=s.Copy().Substring(3);u.indParams={name:e,values:[]};break}if(!i.LabelUtils.CheckIllegal(s.text,!1)){const e=c.Localization.GetMessage("Label {0} illegal",s.text);r.MyDiagnostic.PushException(s,e),t.lineType=m.LineType.Error;continue}const n={token:s,type:i.LabelType.Parameter,scope:i.LabelScope.Global,fileIndex:0};u.params.set(s.text,{label:n,values:[]})}u.lines=a.Utils.DeepClone(e.allLines.slice(e.index+1,p)),u.lineOffset=e.index+1,l.Compiler.enviroment.SetRange({type:"macro",key:u.name.text,startLine:u.lineOffset,endLine:p}),h.Command.MarkLineFinished(e,e.index+1,p),t.tag=u,l.Compiler.enviroment.AddMacro(u);const C=new n.CompileOption;C.macro=u,C.allLines=u.lines,await d.Analyser.AnalyseFirst(C)}async AnalyseSecond(e){const t=e.GetCurrent().tag,s=new n.CompileOption;s.macro=t,s.allLines=t.lines,await d.Analyser.AnalyseSecond(s)}async AnalyseThird(e){const t=e.GetCurrent().tag,s=new n.CompileOption;s.macro=t,s.allLines=t.lines,await d.Analyser.AnalyseThird(s)}async Compile(e){l.Compiler.FirstCompile()&&await this.AnalyseFirst(e)}}},134:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorCommand=t.MsgCommand=void 0;const n=s(581),i=s(828),o=s(200),r=s(642),a=s(366),d=s(738),l=s(521),c=s(770);t.MsgCommand=class{constructor(){this.start={name:".MSG",min:1},this.AnalyseFirst=p.AnalyseFirst,this.AnalyseThird=p.AnalyseThird}Compile(e){d.Compiler.FirstCompile()&&this.AnalyseFirst(e),d.Compiler.enviroment.compileTime<n.Config.ProjectSetting.compileTimes-1||p.Compile(e)}},t.ErrorCommand=class{constructor(){this.start={name:".ERROR",min:1},this.AnalyseFirst=p.AnalyseFirst,this.AnalyseThird=p.AnalyseThird}Compile(e){d.Compiler.FirstCompile()&&this.AnalyseFirst(e);const t=e.GetCurrent();p.Compile(e),t.lineType=c.LineType.Error;const s=l.Localization.GetMessage("compile error");r.MyDiagnostic.PushException(t.command,s)}};class p{static AnalyseFirst(e){const t=e.GetCurrent(),s=t.arguments[0];if(!/^\".*\"$/g.test(s.text)){const e=l.Localization.GetMessage("Command arguments error");return r.MyDiagnostic.PushException(s,e),void(t.lineType=c.LineType.Error)}const n={message:s.Substring(1,s.length-2),expressions:[]};for(let e=1;e<t.arguments.length;e++){const s=i.ExpressionUtils.SplitAndSort(t.arguments[e]);s?n.expressions[e-1]=s:t.lineType=c.LineType.Error}t.tag=n}static AnalyseThird(e){const t=e.GetCurrent().tag;for(let s=0;s<t.expressions.length;s++)i.ExpressionUtils.CheckLabels(e,t.expressions[s])}static Compile(e){const t=e.GetCurrent(),s=t.tag,n=[];for(let t=0;t<s.expressions.length;++t){const o=s.expressions[t],r=i.ExpressionUtils.GetValue(o.parts,e);r.success&&(n[t]=a.Utils.ConvertValue(r.value))}const p=/[@\$]?{(?<index>[0-9])}/g;let m,h="",u=0,g=s.message.text;for(;m=p.exec(s.message.text);){let e=parseInt(m.groups.index);if(n[e]){switch(m[0][0]){case"@":h+=g.substring(u,m.index)+"@"+n[e].bin;break;case"$":h+=g.substring(u,m.index)+"$"+n[e].hex;break;default:h+=g.substring(u,m.index)+n[e].dec}u=m.index+m[0].length}else{const e=l.Localization.GetMessage("Command arguments error"),n=s.message.Substring(m.index,m[0].length);r.MyDiagnostic.PushException(n,e),t.lineType=c.LineType.Error}}if(t.lineType===c.LineType.Error)return;h+=g.substring(u);const C=d.Compiler.enviroment.GetFilePath(d.Compiler.enviroment.fileIndex),x=l.Localization.GetMessage("out put message File{0}, Line{1}, Message{2}",C,t.command.line+1,h);o.FileUtils.ShowMessage?.(x)}}},153:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Base=t.Original=void 0;const n=s(828),i=s(738),o=s(770);t.Original=class{constructor(){this.start={name:".ORG",min:1,max:1},this.AnalyseThird=r.CheckLabels}AnalyseFirst(e){r.Analyse(e)}Compile(e){const t=r.Analyse(e);if(!t?.tag?.exp)return;const s=t.tag,a=n.ExpressionUtils.GetValue(s.exp.parts,{macro:e.macro,tryValue:!1});if(!a.success||a.value<0)return void(t.lineType=o.LineType.Error);t.lineType=o.LineType.Finished;const d=i.Compiler.enviroment.address.org;i.Compiler.enviroment.address.org=a.value,i.Compiler.enviroment.address.base<0&&(i.Compiler.enviroment.address.base=0),d>=0?i.Compiler.enviroment.address.base=i.Compiler.enviroment.address.org+i.Compiler.enviroment.address.offset:i.Compiler.enviroment.address.offset=i.Compiler.enviroment.address.base-i.Compiler.enviroment.address.org}},t.Base=class{constructor(){this.start={name:".BASE",min:1,max:1},this.AnalyseThird=r.CheckLabels}AnalyseFirst(e){r.Analyse(e)}Compile(e){const t=r.Analyse(e);if(!t?.tag?.exp)return;const s=t.tag,a=n.ExpressionUtils.GetValue(s.exp.parts,{macro:e.macro,tryValue:!1});!a.success||a.value<0?t.lineType=o.LineType.Error:(t.lineType=o.LineType.Finished,i.Compiler.enviroment.address.base=a.value,i.Compiler.enviroment.address.offset=i.Compiler.enviroment.address.base-i.Compiler.enviroment.address.org)}};class r{static Analyse(e){const t=e.GetCurrent(),s={exp:n.ExpressionUtils.SplitAndSort(t.arguments[0])};if(s.exp)return t.tag=s,t;t.lineType=o.LineType.Error}static CheckLabels(e){const t=e.GetCurrent().tag;n.ExpressionUtils.CheckLabels(e,t.exp)}}},607:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RepeatCommand=void 0;const n=s(735),i=s(828),o=s(366),r=s(738),a=s(770);t.RepeatCommand=class{constructor(){this.start={name:".REPEAT",min:1,max:1},this.end=".ENDR"}static GetResult(e,t){const s=e.GetCurrent().tag,i=new n.CompileOption;i.allLines=s.compileLines,r.Compiler.GetLinesResult(i,t)}AnalyseFirst(e){this.AnalyseLines(e)}AnalyseThird(e){const t=e.GetCurrent().tag;i.ExpressionUtils.CheckLabels(e,t.exp)}async Compile(e){const t=e.GetCurrent(),s=i.ExpressionUtils.SplitAndSort(t.arguments[0]);if(!s)return void(t.lineType=a.LineType.Error);let d;if(r.Compiler.FirstCompile()){if(d=this.AnalyseLines(e),!d)return;const n=i.ExpressionUtils.GetValue(s.parts,{macro:e.macro,tryValue:!1});if(!n.success)return;const r=[];for(;n.value>0;){const e=o.Utils.DeepClone(t.tag.orgLines);r.push(...e),n.value--}for(let e=0;e<t.tag.orgLines.length;e++)t.tag.orgLines[e]&&(t.tag.orgLines[e].lineType=a.LineType.Finished);t.tag.compileLines=r}d=t.tag;const l=new n.CompileOption;l.allLines=d.compileLines,l.macro=e.macro,await r.Compiler.Compile(l),e.index+=d.orgLines.length+1}AnalyseLines(e){const t=e.GetCurrent(),s=i.ExpressionUtils.SplitAndSort(t.arguments[0]);if(!s)return void(t.lineType=a.LineType.Error);const n={exp:s,orgLines:[],compileLines:[]},o=e.matchIndex[0];return n.orgLines=e.allLines.slice(e.index+1,o),e.allLines[o].lineType=a.LineType.Ignore,t.tag=n,n}}},958:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Analyser=void 0;const n=s(74),i=s(382),o=s(126),r=s(738),a=s(747),d=s(770),l=s(634),c=s(317),p=s(43),m=s(823);class h{static AnalyseText(e,t){let s,n,o;const c=[],m=e.split(/\r?\n/g),u=r.Compiler.enviroment.fileIndex;let g,C;for(let e=0;e<m.length;e++)if(s=new i.Token(m[e],{line:e}),n=h.GetContent(s),o=h.MatchLineCommon(n.content),void 0===n.comment?n.content.isEmpty&&(g=void 0):void 0===g?g=n.comment:g+="\n"+n.comment,!n.content.isEmpty){switch(o.key){case"instruction":C=a.InstructionLine.Create(n.content,o.content,g);break;case"command":C=l.CommandLine.Create(n.content,o.content,g);break;case"variable":C=p.VariableLine.Create(n.content,o.content,g);break;case"unknow":C=d.UnknowLine.Create(n.content,g)}C&&(c[e]=C,g=void 0)}return r.Compiler.enviroment.allLine.set(u,c),c}static MatchLineCommon(e){let t=h.MatchLine(e,!0,["instruction",n.Platform.instructions],["command",o.Command.commandParam]);if("unknow"===t.key){const s=h.SplitWithChar(e.start,e.text,h.equal);s.text.length!==e.text.length&&(t.key="variable",t.org=e,t.content={pre:new i.Token(s.text,{start:s.start,line:e.line}),main:e.Substring(s.text.length,1),rest:e.Substring(s.text.length+1)})}return t}static MatchLine(e,t,...s){const n={key:"unknow",org:e};if(e.isEmpty)return n;let o=0,r=0;for(;;){const a=h.SplitWithChar(r,e.text,h.space);if(o>1||""===a.text)break;const d=t?a.text.toUpperCase():a.text;for(let e=0;e<s.length;e++){const t=s[e];if(t[1].has(d)){n.key=t[0];break}}if("unknow"===n.key){r=a.start+a.text.length+1,o++;continue}n.content={},n.content.main=new i.Token(a.text,{start:a.start+e.start,line:e.line}),n.content.pre=e.Substring(0,a.start-1);const l=a.start+a.text.length;return n.content.rest=e.Substring(l).Trim(),n}return n}static SplitComma(e,t){if(!e||e.isEmpty)return;let s=[],n=t?.count??0,o=0;for(;;){let t=h.SplitWithChar(o,e.text,h.comma);if(""===t.text)break;if(s.push(new i.Token(t.text,{start:o+e.start,line:e.line})),o+=t.text.length+1,0==--n){let t=e.Substring(o);t.isEmpty||s.push(t);break}}return s}static async AnalyseFirst(e){for(let t=0;t<e.allLines.length;t++){e.index=t;const s=e.GetCurrent();if(s&&s.lineType===d.LineType.None){switch(s.key){case"command":await o.Command.AnalyseFirst(e);break;case"instruction":case"variable":s.AnalyseFirst(e)}t=e.index}}}static async AnalyseSecond(e){for(let t=0;t<e.allLines.length;t++){e.index=t;const s=e.GetCurrent();if(!s||s.lineType!==d.LineType.None)continue;let n;switch(s.key){case"unknow":const t=h.MatchLine(s.org,!1,["macro",r.Compiler.enviroment.allMacro]);"macro"===t.key?(n=m.MacroLine.Create(t.content,s.comment),n?.AnalyseLabel()):(n=c.LabelLine.Create(s.org,s.comment),n?.Analyse());break;case"command":await o.Command.AnalyseSecond(e)}n&&(e.allLines[e.index]=n),t=e.index}}static async AnalyseThird(e){for(let t=0;t<e.allLines.length;t++){e.index=t;const s=e.GetCurrent();if(s&&s.lineType===d.LineType.None){switch(s.key){case"instruction":case"macro":case"variable":s.AnalyseThird(e);break;case"command":await o.Command.AnalyseThird(e)}t=e.index}}}static GetContent(e){let t=e.text.indexOf(";");if(t<0)return{content:e.Copy(),comment:void 0};let s=e.text.substring(t+1);return"+"!==s[0]&&"-"!==s[0]||(s=e.text.substring(t+2)),{content:e.Substring(0,t),comment:s}}static SplitWithChar(e,t,s){let n=e,i="",o=!1;for(let r=e;r<t.length;r++)if(o){if('"'!==t[r])continue;"\\"!==t[r-1]&&(o=!1)}else if('"'!==t[r]){if(s.has(t[r])){if(i=t.substring(n,r),""===i.trim()){n++;continue}break}}else o=!0;return""===i&&(i=t.substring(n)),{start:n,text:i}}}t.Analyser=h,h.space=new Set([" ","\t"]),h.comma=new Set(","),h.equal=new Set("=")},603:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CompileResult=void 0;const n=s(738);t.CompileResult=class{constructor(){this.baseAddLines=new Map,this.fileLines=new Map,this.finished=!1}SetLine(e){this.baseAddLines.set(e.baseAddress,{fileIndex:e.fileIndex,lineNumber:e.lineNumber,line:e.line});let t=this.fileLines.get(e.fileIndex);t||(t=new Map,this.fileLines.set(e.fileIndex,t)),t.set(e.lineNumber,{baseAddress:e.baseAddress,line:e.line})}GetLineWithBaseAddress(e){const t=this.baseAddLines.get(e);if(t)return{filePath:n.Compiler.enviroment.GetFilePath(t.fileIndex),lineNumber:t.lineNumber,line:t.line}}GetLineWithFileAndLine(e,t){const s=this.fileLines.get(e);if(s)return s.get(t)}ClearAll(){this.baseAddLines.clear(),this.fileLines.clear(),this.finished=!1}}},738:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Compiler=void 0;const n=s(581),i=s(754),o=s(126),r=s(127),a=s(607),d=s(770),l=s(317),c=s(823),p=s(958);class m{static ChangeEnv(e){switch(e){case"edit":m.enviroment=m.editEnv;break;case"compile":m.enviroment=m.compileEnv}}static async Compile(e){for(let t=0;t<e.allLines.length;t++){e.index=t;let s=e.allLines[t];if(s&&s.lineType===d.LineType.None){switch(s.key){case"instruction":case"label":case"variable":s.Compile(e);break;case"command":await o.Command.Compile(e);break;case"unknow":const n=p.Analyser.MatchLine(s.org,!1,["macro",m.enviroment.allMacro]);"macro"===n.key?(s=c.MacroLine.Create(n.content,s.comment),await(s?.Compile(e))):(s=l.LabelLine.Create(s.org,s.comment),s?.Compile(e)),s&&(e.allLines[t]=s);break;case"macro":await s.Compile(e)}if(t=e.index,s.lineType===d.LineType.Error){m.stopCompiling=!0,m.enviroment.compileTime=n.Config.ProjectSetting.compileTimes;break}}}}static GetLinesResult(e,t){for(let s=0;s<e.allLines.length;s++){e.index=s;const n=e.allLines[s];if(n&&n.lineType!==d.LineType.Ignore){e:switch(n.key){case"macro":c.MacroLine.GetLineResult(e,t);break;case"command":switch(n.command.text.toUpperCase()){case".INCLUDE":r.Include.GetResult(e,t);break e;case".REPEAT":a.RepeatCommand.GetResult(e,t);break e}case"instruction":if(n.lineResult.address.org<0||0===n.lineResult.resultLength)continue;if("instruction"===n.key){const e=m.enviroment.fileIndex;m.enviroment.compileResult.SetLine({baseAddress:n.lineResult.address.base,fileIndex:e,lineNumber:n.org.line,line:n})}for(let e=0;e<n.lineResult.result.length;e++)t[n.lineResult.address.base+e]=n.lineResult.result[e]}s=e.index}}}static FirstCompile(){return 0===m.enviroment.compileTime}}t.Compiler=m,m.enviroment=new i.Enviroment,m.isCompiling=!1,m.stopCompiling=!1,m.editEnv=new i.Enviroment,m.compileEnv=new i.Enviroment},210:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CommandTip_English=t.English=void 0,t.English={"Unsupport platform {0}":'Unsupport platform "{0}"',"Label {0} not found":'Label "{0}" not found',"Can not use nameless label in Macro":"Can not use nameless label in Macro","Label {0} illegal":'Label "{0}" illegal',"Label {0} is already defined":'Label "{0}" is already defined',"Unknow instruction {0}":'Unknow instruction "{0}"',"Instruction {0} do not support this addressing mode":'Instruction "{0}" do not support this addressing mode',"Command {0} Error":'Command "{0}" Error',"Expression error":"Expression error","Macro arguments error":"Macro arguments error","Command {0} do not support nesting":'Command "{0}" do not support nesting',"Command {0} can not use in Macro":'Command "{0}" can not use in Macro',"Unmatched command {0}":'Unmatched command "{0}"',"Command {0} can not use label":'Command "{0}" can not use label',"Command arguments error":"Command arguments error","Unknow original address":"Unknow original address","File {0} is not exist":'File "{0}" is not exist',"Argument out of range":"Argument out of range","Expression result is {0}, but compile result is {1}":'Expression result is "{0}", but compile result is "{1}"',"Macro arguments count is {0}, but got {1}":'Macro arguments count is "{0}", but got "{1}"',"Data group {0} do not found":'Data group "{0}" do not found',"Unsupport string":"This expression do not support using string","rename error":"Can not rename","format error":"Can not format",compiling:"compiling","compile finished":"compile finished","compile error":"compile error","plugin loading":"plugin loading","plugin loaded":"plugin loaded","empty addressing mode":"(Empty)",example:"Example:",paramters:"All Paramters: ","out put message File{0}, Line{1}, Message{2}":'File: "{0}"\nLine: {1}\n{2}\n\n',baseOrgResult:"BASE:{0}  ORG:{1}  Result:{2}","Please compile the file before Debug":"Please compile the file before Debug","Debugger can not connect to the emulator":"Debugger can not connect to the emulator","Cannot find launch.json":"Cannot find launch.json","Cannot find rom file {0}":"Cannot find rom file {0}","Cannot find program path {0}":"Cannot find program path {0}"},t.CommandTip_English={def:{comment:"Define a constant.",format:".DEF name, expression",exp:".DEF PPU.CTRL_REG1, $2000"},macro:{comment:"Define a macro.",format:".MACRO name[, arg0, arg1...]\n;Your code\n.ENDM",exp:".MACRO TXY\nTXA\nTAY\n.ENDM"},org:{comment:"Set the starting address.\nNote：If you use the .BASE command, after .ORG, otherwise it compiles incorrectly.",format:".ORG expression",exp:".ORG $8000\n.ORG *\t;'*' means currect ORG address"},base:{comment:"Set the program address.\nNote：If you use the .BASE command, after .ORG, otherwise it compiles incorrectly.",format:".BASE expression",exp:".BASE $8000\n.BASE $\t;'$' means currect BASE address"},include:{comment:"Assemble source file.",format:'.INCLUDE "filePath.asm"',exp:'.INCLUDE "../folder/file.asm"\t;Relative path\n.INCLUDE "D:/folder/file.asm"\t;Absolute path'},incbin:{comment:"Add the contents of a file to the assembly output.",format:'.INCBIN "file.bin"[, fileStartPosition, readLength]',exp:'.INCBIN "chr.bin", 0, $1000'},db:{comment:"Emit bytes",format:".DB arg0[, arg1, arg2...]"},dw:{comment:"Emit words",format:".DB arg0[, arg1, arg2...]"},dl:{comment:"Emit four-bytes",format:".DB arg0[, arg1, arg2...]"},if:{comment:"Confident branch",format:".IF expression\n...\n.ELSEIF\n...\n.ELSE\n...\n.ENDIF"},ifdef:{comment:"If a label or macro has been defined",format:".IFDEF label or macro\n...\n.ELSE\n...\n.ENDIF"},ifndef:{comment:"If a label or macro has been not defined",format:".IFNDEF label or macro\n...\n.ELSE\n...\n.ENDIF"},hex:{comment:"Compact way of laying out a table of hex values.\n\nOnly raw hex values are allowed, no expressions.\n\nSpaces can be used to separate numbers.",format:".HEX hex string",exp:".HEX 456789ABCDEF\t;equivalent to .DB $45,$67,$89,$AB,$CD,$EF\n.HEX 0 1 23 4567\t;equivalent to .DB $00,$01,$23,$45,$67"},msg:{comment:"Out put a message. You can format value to binary, decimal or hexadecimal.",format:".MSG message[, arg0, arg1...]",exp:'.ORG $8000\n.MSG "Now ORG address: {0}, @{0}, ${0}", *\n\n;Now ORG address: 32768, @1000 0000 0000 0000, $8000'},error:{comment:"Out put a message and stop compile, you can format output message.",format:'.ERROR "Your message"[, arg0, arg1...]',exp:'.ERROR "Compile error"\n;Compile error'},enum:{comment:"Reassign PC and suppress assembly output.\n\nUseful for defining variables in RAM.",format:".ENUM startAddress\nlabelName, byteLength\n...\n.ENDE",exp:".ENUM $300\n\tmusic.counter, 1\t; .DEF music.counter, $300\n\tmusic.addrHigh, 2\t; .DEF music.addrHigh, music.counter + 1 ($301)\n\tmusic.addrLow, 3\t; .DEF music.addrLow, music.addrHigh + 2 ($303)\n.ENDE"}}},521:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Localization=void 0;const n=s(210),i=s(186);class o{static ChangeLanguage(e){o.ChangeCommandTip();const t=[n.English,i.Chinese],s=[n.CommandTip_English,i.CommandTip_Chinese];let r=["en","zh-cn"].indexOf(e);r<0&&(r=0),o.message=t[r],o.commandTip=s[r]}static GetMessage(e,...t){let s=o.message[e];return s=o.StringFormat(s,...t),s}static GetCommandTip(e){return o.commandTip[e]}static ChangeCommandTip(){o.CopyValue("macro","endm"),o.CopyValue("enum","ende")}static CopyValue(e,t,...s){const o=[i.CommandTip_Chinese,n.CommandTip_English];for(let s=0;s<o.length;s++){const n=o[s];n[t]=n[e]}}static StringFormat(e,...t){for(let s=0;s<t.length;++s)e=e.replace(`{${s}}`,t[s].toString());return e}}t.Localization=o,o.message=i.Chinese,o.commandTip=n.CommandTip_English},186:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CommandTip_Chinese=t.Chinese=void 0,t.Chinese={"Unsupport platform {0}":'尚未支持的编译平台 "{0}"',"Label {0} not found":'未找到标签 "{0}"',"Can not use nameless label in Macro":"不能在Macro函数内使用临时标签","Label {0} illegal":'标签 "{0}" 命名有误',"Label {0} is already defined":'标签 "{0}" 重复',"Unknow instruction {0}":'未知的汇编指令 "{0}"',"Instruction {0} do not support this addressing mode":'汇编指令 "{0}" 不支持该寻址方式',"Command {0} Error":'命令 "{0}" 错误',"Expression error":"表达式错误","Macro arguments error":"自定义函数参数错误","Command {0} do not support nesting":'命令 "{0}" 不支持嵌套',"Command {0} can not use in Macro":'命令 "{0}" 不能使用在自定义函数内',"Unmatched command {0}":'找不到匹配的命令 "{0}"',"Command {0} can not use label":'命令 "{0}" 不支持标签',"Command arguments error":"命令参数错误","Unknow original address":"未设定起始地址","File {0} is not exist":'文件 "{0}" 不存在',"Argument out of range":"参数超出范围","Expression result is {0}, but compile result is {1}":'表达式结果为 "{0}", 最终编译结果值为 "{1}"',"Macro arguments count is {0}, but got {1}":'自定义函数参数个数应该为 "{0}", 但目前参数个数为 "{1}"',"Data group {0} do not found":'数据组 "{0}" 未找到',"Unsupport string":"这个表达式不支持字符串","rename error":"重命名错误","format error":"格式化错误",compiling:"编译中","compile finished":"编译完成","compile error":"编译错误","plugin loading":"编译器插件载入中","plugin loaded":"编译器插件载入完成","empty addressing mode":"空",example:"例子：",paramters:"所有参数: ","out put message File{0}, Line{1}, Message{2}":'文件: "{0}"\n第 {1} 行\n{2}\n\n',baseOrgResult:"文件基址:{0}  编译地址:{1}  结果值:{2}","Please compile the file before Debug":"请在Debug之前编译文件","Debugger can not connect to the emulator":"调试器未能连接模拟器","Cannot find launch.json":"找不到 launch.json","Cannot find rom file {0}":"找不到 rom {0}","Cannot find program path {0}":"找不到启动程序  {0}"},t.CommandTip_Chinese={def:{comment:"定义一个常量。",format:".DEF 名称, 表达式",exp:".DEF PPU.CTRL_REG1, $2000"},macro:{comment:"定义一个宏。",format:".MACRO 名称[, 参数0, 参数1...]\n;你的代码\n.ENDM",exp:".MACRO TXY\n\tTXA\n\tTAY\n.ENDM"},org:{comment:"设定编译起始地址。\n注意：如果使用 .BASE 命令，则在 .ORG 之后，否则编译错误。",format:".ORG 表达式",exp:".ORG $8000\n.ORG *\t;'*'代表当前 ORG 地址"},base:{comment:"设定文件起始地址。\n注意：如果使用 .BASE 命令，则在 .ORG 之后，否则编译错误。",format:".BASE 表达式",exp:".BASE $0000\n.BASE $\t;'$'代表当前 BASE 地址"},include:{comment:"引用另一个汇编文件",format:'.INCLUDE "文件.asm"',exp:'.INCLUDE "../文件夹/文件.asm"\t;相对路径\n.INCLUDE "D:/文件夹/文件.asm"\t;绝对路径'},incbin:{comment:"编译文件的二进制到编译结果内，路径用法基本和 .INCLUDE 用法一致",format:'.INCBIN "文件.bin"[, 文件读取起始位置, 读取长度]',exp:'.INCBIN "chr-rom.bin", 0, $1000'},db:{comment:"单字节数据",format:".DB 参数0[, 参数1, 参数2...]"},dw:{comment:"双字节数据",format:".DW 参数0[, 参数1, 参数2...]"},dl:{comment:"四字节数据",format:".DL 参数0[, 参数1, 参数2...]"},if:{comment:"宏判断条件",format:".IF 表达式\n...\n.ELSEIF\n...\n.ELSE\n...\n.ENDIF"},ifdef:{comment:"判断标签或自定义函数已定义",format:".IFDEF 标签名称或自定义函数\n...\n.ELSE\n...\n.ENDIF"},ifndef:{comment:"判断标签或自定义函数未定义",format:".IFNDEF 标签名称或自定义函数\n...\n.ELSE\n...\n.ENDIF"},hex:{comment:"一段16进制数据，可以用空格隔开。",format:".HEX 16进制字符",exp:".HEX 456789ABCDEF\t;类似 .DB $45,$67,$89,$AB,$CD,$EF\n.HEX 0 1 23 4567\t;类似 .DB $00,$01,$23,$45,$67"},msg:{comment:"输出信息，你可以格式化输出数据，具体参考例子。",format:'.MSG "你要输出的信息"[, 参数0, 参数1...]',exp:'.ORG $8000\n.MSG "当前编译地址: {0} @{0}, ${0}", *\n;当前编译地址: 32768, @1000 0000 0000 0000, $8000'},error:{comment:"输出信息，同时停止编译，可以格式化输出数据。",format:'.ERROR "你要输出的信息"[, 参数0, 参数1...]',exp:'.ERROR "编译有误"\n;编译有误'},enum:{comment:"用于定义一连串的常量，一般用于定义连续的内存地址作为标记",format:".ENUM 起始地址\n常量名称, 占用字节长度\n...\n.ENDE",exp:".ENUM $300\n\tmusic.counter, 1\t; .DEF music.counter, $300\n\tmusic.addrHigh, 2\t; .DEF music.addrHigh, music.counter + 1 ($301)\n\tmusic.addrLow, 3\t; .DEF music.addrLow, music.addrHigh + 2 ($303)\n.ENDE"}}},538:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DebugProvider=void 0;const n=s(738);t.DebugProvider=class{static GetDebugLine(e){return n.Compiler.enviroment.compileResult.GetLineWithBaseAddress(e)}static GetDebugLineWithFile(e,t){const s=n.Compiler.enviroment.GetFileIndex(e,!1);return n.Compiler.enviroment.compileResult.GetLineWithFileAndLine(s,t)}static SetBreakPoint(e,t){const s=n.Compiler.enviroment.GetFileIndex(e,!1);return n.Compiler.enviroment.compileResult.GetLineWithFileAndLine(s,t)}}},422:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DefinitionProvider=void 0;const n=s(185),i=s(738),o=s(565);class r{static GetDefinitionPosition(e,t,s,a){const d={filePath:"",line:0,start:0,length:0},l=i.Compiler.enviroment.GetFileIndex(e,!1),c=o.HelperUtils.FindMatchToken(l,t,s,a);if("none"!==c.type){switch(c.type){case"label":if(c.token){const e=n.LabelUtils.FindLabel(c.token,{fileIndex:l});e&&(r.SetTokenToResult(e.token,d),d.filePath=i.Compiler.enviroment.GetFilePath(e.fileIndex))}case"macro":const e=i.Compiler.enviroment.allMacro.get(c.token.text);e&&(r.SetTokenToResult(e.name,d),d.filePath=i.Compiler.enviroment.GetFilePath(e.fileIndex));break;case"filePath":d.filePath=c.token.text}return d}}static SetTokenToResult(e,t){t.start=e.start,t.line=e.line,t.length=e.length}}t.DefinitionProvider=r},698:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DocumentChangeProvider=void 0;const n=s(382),i=s(958);t.DocumentChangeProvider=class{static AutoUpperCase(e){const t=new n.Token(e),s=i.Analyser.MatchLineCommon(t);switch(s.key){case"command":case"instruction":const e=s.content.main;return{index:e.start,length:e.length,text:e.text.toUpperCase()};default:return}}}},565:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HelperUtils=void 0;const n=s(828),i=s(382),o=s(958),r=s(738),a=s(521);class d{static FindMatchToken(e,t,s,n){const a={type:"none",token:void 0,tag:void 0},l=new i.Token(t,{line:s}),c=o.Analyser.GetContent(l);if(n>c.content.start+c.content.length)return a.type="comment",a;let p,m;const h=r.Compiler.enviroment.GetRange(e,s);switch(h?.type){case"macro":p=r.Compiler.enviroment.allMacro.get(h.key);break;case"enum":if(d.MatchEnum(h,a,e,t,s,n))return a;break;case"dataGroup":if(d.MatchDataGroup(h,a,e,t,s,n))return a}let u=o.Analyser.MatchLineCommon(c.content);switch("unknow"===u.key&&(u=o.Analyser.MatchLine(c.content,!1,["macro",r.Compiler.enviroment.allMacro])),u.key){case"instruction":if(d.CurrentInToken(n,u.content.main))return a.type=u.key,a.token=u.content.main,a;{const t=r.Compiler.enviroment.allLine.get(e)?.[s];if(!t)return a;if(m=d.CurrentInExpression(n,...t.expressions))return a.type=m.type,a.token=m.token,a}break;case"command":if(d.CurrentInToken(n,u.content.main))return a.type=u.key,a.token=u.content.main,a;d.CommandSp(e,t,s,n,a,{macro:p});break;case"macro":if(d.CurrentInToken(n,u.content.main))return a.type=u.key,a.token=u.content.main,a;n>u.content.rest.start&&!u.content.rest.isEmpty?d.MatchLabelOrNumber(t,n,a):n<u.content.main.start&&!u.content.pre.isEmpty&&(a.type="label",a.token=u.content.pre);break;case"unknow":const i=r.Compiler.enviroment.allLine.get(e)?.[s];if(!i)break;d.CurrentInToken(n,i.labelToken)&&(a.type="label",a.token=i.labelToken)}return a}static GetWord(e,t,s=0){let n=!1,i="";const o=[0,0];t-=s;let r=!1;for(let s=0;s<e.length;++s)if(n&&'"'!==e[s])i=e[s];else{if('"'===e[s]?n?"\\"!==i&&(n=!1,o[1]=s+1,r=!0):(n=!0,o[0]=s):"\t +-*/&|!^#,()[]{}<>".includes(e[s])&&(r=!r,r?o[1]=s:o[0]=s+1),r){if(t>=o[0]&&t<=o[1])break;r=!1,o[0]=s+1}i=e[s]}return r||(o[1]=e.length),{leftText:e.substring(o[0],t),rightText:e.substring(t,o[1]),start:o[0]+s}}static FormatComment(e){let t="";if(void 0!==e.comment&&(t+=d.useMarkDown?e.comment.replace(/\n/g,"\n\n"):e.comment),e.macro&&(""!==t&&(t+=d.useMarkDown?"\n\n---\n\n":"\n"),0!==e.macro.params.size&&(t+=a.Localization.GetMessage("paramters"),e.macro.params.forEach((e=>{t+=(d.useMarkDown?`\`${e.label.token.text}\``:e.label.token.text)+", "})),t=t.substring(0,t.length-2))),void 0!==e.value){""!==t&&(t+=d.useMarkDown?"\n\n---\n\n":"\n");const s=d.ConvertValue(e.value);d.useMarkDown?(t+="`BIN:` @"+s.bin+"\n\n",t+="`DEC:` "+s.dec+"\n\n",t+="`HEX:` $"+s.hex):(t+="BIN: @"+s.bin+"\n",t+="DEC: "+s.dec+"\n",t+="HEX: $"+s.hex)}if(e.commadTip){const s=e.commadTip.toLowerCase().substring(1),n=a.Localization.GetCommandTip(s);d.useMarkDown?(t+=n.comment.replace(/\n/g,"\n\n"),t+="\n\n",t+=d.ConvertCodeToMarkdown(n.format),n.exp&&(t+="\n\n---\n\n"+a.Localization.GetMessage("example")+"\n\n",t+=d.ConvertCodeToMarkdown(n.exp))):(t+=n.comment,t+="\n",t+=n.format,n.exp&&(t+="\n\n"+a.Localization.GetMessage("example")+"\n",t+=n.exp))}return t}static MatchLine(e){let t=o.Analyser.MatchLineCommon(e);return"unknow"===t.key&&(t=o.Analyser.MatchLine(e,!1,["macro",r.Compiler.enviroment.allMacro])),t}static CurrentInExpression(e,...t){let s,i={expIndex:-1,token:{},type:"none"};for(let o=0;o<t.length;o++){s={min:void 0,max:void 0};for(let r=0;r<t[o].parts.length;r++){const a=t[o].parts[r];(void 0===s.min||s.min>a.token.start)&&(s.min=a.token.start);const d=a.token.start+a.token.length;switch((void 0===s.max||s.max<d)&&(s.max=d),a.type){case n.PriorityType.Level_1_Label:case n.PriorityType.Level_2_Address:if(a.token.start<=e&&e<=d)return i.expIndex=o,i.token=a.token,i.type=a.type===n.PriorityType.Level_1_Label?"label":"number",i;continue;default:continue}}if(void 0!==s.min&&e>=s.min&&e<=s.max)return i.expIndex=o,i;s={min:void 0,max:void 0}}}static CurrentInToken(e,...t){for(let s=0;s<t.length;s++){const n=t[s];if(n.start<=e&&e<=n.start+n.length)return{token:n,index:s}}}static CommandSp(e,t,s,n,o,a){let l,c=0;if(a?.macro?(l=a.macro.lines,c=a.macro.lineOffset):l=r.Compiler.enviroment.allLine.get(e),!l)return;const p=l[s-c];if(!p)return;let m,h;switch(p.command.text.toLocaleUpperCase()){case".DB":case".DW":case".DL":if(n>p.command.start+p.command.length)return void d.MatchLabelOrNumber(t,n,o);break;case".DEF":if(m=p.tag,m.label&&d.CurrentInToken(n,m.label.token))return o.type="label",void(o.token=m.label.token);if(m.exp&&(h=d.CurrentInExpression(n,m.exp)))return o.type=h.type,void(o.token=h.token);break;case".INCLUDE":case".INCBIN":if(m=p.tag,d.CurrentInToken(n,m.orgPath))return o.type="filePath",void(o.token=new i.Token(m.path));if(h=m.exps,h&&(h=d.CurrentInExpression(n,...h)))return o.type=h.type,void(o.token=h.token);break;case".BASE":case".ORG":case".IF":case".ELSEIF":case".REPEAT":if(h=p.tag,h?.exp&&(h=d.CurrentInExpression(n,h.exp)))return o.type=h.type,void(o.token=h.token);break;case".MACRO":if(h=p.tag,d.CurrentInToken(n,h.name))return o.type="macro",void(o.token=h.name);const e=[];if(h.params.forEach(((t,s,n)=>{e.push(t.label.token)})),h=d.CurrentInToken(n,...e))return o.type="macroLabel",o.token=h.token,void(o.tag=p.tag)}}static MatchDataGroup(e,t,s,n,i,o){const a=r.Compiler.enviroment.allLine.get(s)?.[e.startLine];if(!a||i===e.startLine||i===e.endLine)return!1;const l=a.tag;for(let e=0;e<l.expressions.length;e++){const s=l.expressions[e],n=d.CurrentInExpression(o,s);if(n)return t.type=n.type,t.token=n.token,!0}return!1}static MatchEnum(e,t,s,n,i,o){const a=r.Compiler.enviroment.allLine.get(s)?.[e.startLine];if(!a||i===e.startLine||i===e.endLine)return!1;const l=a.tag;for(let e=0;e<l.lines.length;e++){const s=l.lines[e];if(s&&s.labelToken.line===i)return d.CurrentInToken(o,s.labelToken)?(t.token=s.labelToken,t.type="label",!0):(d.MatchLabelOrNumber(n,o,t),!0)}}static MatchLabelOrNumber(e,t,s){let o=d.GetWord(e,t);const r=o.leftText+o.rightText;n.ExpressionUtils.GetNumber(r).success?s.type="number":s.type="label",s.token=new i.Token(r,{start:o.start})}static ConvertValue(e){let t={bin:"",dec:"",hex:""},s=e;do{let e=(15&s).toString(2).padStart(4,"0");t.bin=" "+e+t.bin,s>>>=4}while(0!==s);return t.bin=t.bin.substring(1),t.dec=e.toString(),t.hex=e.toString(16).toUpperCase(),t}static ConvertCodeToMarkdown(e){let t="```\n";const s=e.split(/\n/);for(let e=0;e<s.length;e++)t+="    "+s[e]+"\n";return t+="```",t}}t.HelperUtils=d,d.useMarkDown=!0},963:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HighlightingProvider=t.HighlightType=t.HighlightOption=void 0;const n=s(738),i=s(226);class o{constructor(){this.lines=[],this.index=0,this.result=[]}GetCurrent(){return this.lines[this.index]}}var r;t.HighlightOption=o,function(e){e[e.None=0]="None",e[e.Label=1]="Label",e[e.Keyword=2]="Keyword",e[e.Macro=3]="Macro",e[e.Defined=4]="Defined",e[e.Variable=5]="Variable",e[e.Number=6]="Number"}(r||(t.HighlightType=r={}));class a{static HighlightDocument(e){const t=n.Compiler.enviroment.GetFileIndex(e,!1),s=n.Compiler.enviroment.allLine.get(t);if(!s)return[];const i=new o;return i.lines=s,a.GetHighlight(i),i.result}static GetHighlight(e){for(let t=0;t<e.lines.length;t++)e.index=t,a.GetHighlightToken(e),t=e.index}static GetHighlightToken(e){const t=e.GetCurrent();if(t)switch(t.key){case"label":a.GetLabel(t,e.result);break;case"variable":a.GetExpression(t.expression,e.result);break;case"instruction":a.GetLabel(t.label,e.result),a.GetToken(t.instruction,r.Keyword,e.result);for(let s=0;s<t.expressions.length;s++)a.GetExpression(t.expressions[s],e.result);break;case"command":a.GetCommandHighlighting(e);break;case"macro":a.GetLabel(t.label,e.result),a.GetToken(t.name,r.Macro,e.result)}}static GetToken(e,t,s){s.push({line:e.line,start:e.start,length:e.length,type:t})}static GetExpression(e,t){for(let s=0;s<e.parts.length;s++){const n=e.parts[s];a.GetToken(n.token,n.highlightType,t)}}static GetLabel(e,t){e&&a.GetToken(e.labelToken,r.Label,t)}static GetCommandHighlighting(e){const t=e.lines[e.index];let s;switch(a.GetLabel(t.label,e.result),t.command.text){case".ENUM":s=e.GetCurrent().tag,s.exp&&a.GetExpression(s.exp,e.result);for(let t=0;t<s.lines.length;t++){const n=s.lines[t];n&&(a.GetToken(n.labelToken,r.Defined,e.result),a.GetExpression(n.expression,e.result))}e.index+=s.lines.length;break;case".DB":case".DW":case".DL":s=t.tag;for(let t=0;t<s.length;t++)a.GetExpression(s[t],e.result);break;case".MACRO":i.MacroCommand.GetHighlight(e);break;case".ORG":case".BASE":case".IF":case".ELSEIF":s=t.tag,s.exp&&a.GetExpression(s.exp,e.result)}}}t.HighlightingProvider=a},231:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HoverProvider=void 0;const n=s(828),i=s(185),o=s(738),r=s(565);t.HoverProvider=class{static Hover(e,t,s,a){const d=o.Compiler.enviroment.GetFileIndex(e,!1);let l="";const c=r.HelperUtils.FindMatchToken(d,s,t,a);let p;switch(c.type){case"label":const e=i.LabelUtils.FindLabel(c.token,{fileIndex:d});e&&(l=r.HelperUtils.FormatComment(e));break;case"number":p=n.ExpressionUtils.GetNumber(c.token.text),l=r.HelperUtils.FormatComment(p);break;case"command":l=r.HelperUtils.FormatComment({commadTip:c.token.text});break;case"macro":const t=o.Compiler.enviroment.allMacro.get(c.token.text);t&&(l=r.HelperUtils.FormatComment({macro:t,comment:t.comment}))}return l}}},532:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IntellisenseProvider=t.Completion=t.CompletionIndex=void 0;const n=s(738),i=s(581),o=s(200),r=s(382),a=s(366),d=s(185),l=s(565),c=s(74),p=s(126),m=s(958),h=s(521),u=[".DBG",".DWG",".MACRO",".DEF",".INCLUDE",".INCBIN",".ENUM"];var g,C,x;!function(e){e[e.Instruction=0]="Instruction",e[e.AddressingType=1]="AddressingType",e[e.Command=2]="Command",e[e.Macro=3]="Macro",e[e.Defined=4]="Defined",e[e.Label=5]="Label",e[e.Variable=6]="Variable",e[e.UnknowLabel=7]="UnknowLabel",e[e.MacroParamter=8]="MacroParamter",e[e.Folder=9]="Folder",e[e.File=10]="File"}(g||(g={})),function(e){e[e.Folder=0]="Folder",e[e.File=1]="File",e[e.Macro=2]="Macro",e[e.Parameter=3]="Parameter",e[e.Command=4]="Command",e[e.Label=5]="Label",e[e.Defined=5]="Defined",e[e.UnknowLabel=5]="UnknowLabel",e[e.Variable=5]="Variable",e[e.Instruction=6]="Instruction",e[e.EmptyAddressing=7]="EmptyAddressing",e[e.NotEmptyAddressing=8]="NotEmptyAddressing"}(C||(t.CompletionIndex=C={})),function(e){e[e.None=0]="None",e[e.AllAsm=1]="AllAsm",e[e.AllFile=2]="AllFile"}(x||(x={}));class f{static CopyList(e){const t=[];for(let s=0;s<e.length;s++)t.push(e[s]);return t}constructor(e){this.showText="",this.insertText="",this.index=C.Folder,this.showText=e.showText,this.insertText=e.insertText??e.showText,this.index=e.index??0,this.comment=e.comment,this.type=e.type,this.triggerType=e.suggestType}Copy(){return a.Utils.DeepClone(this)}}t.Completion=f;class L{static async Intellisense(e){if(!i.Config.ProjectSetting.intellisense)return[];const t=n.Compiler.enviroment.GetFileIndex(e.filePath,!1),s=new r.Token(e.lineText,{line:e.lineNumber}),o=s.Substring(0,e.current).Trim();if(new RegExp(";|(^|\\s+)(\\.HEX|\\.DBG|\\.DWG|\\.MACRO)(\\s+|$)","ig").test(o.text))return[];let a;const d=n.Compiler.enviroment.GetRange(t,e.lineNumber);switch(d?.type){case"dataGroup":if(" "===e.trigger)return[];const s=l.HelperUtils.GetWord(e.lineText,e.current);return L.GetLabel(t,s.leftText);case"enum":if(e.lineNumber===d.startLine)break;const i=e.lineText.indexOf(",");if(i<0||e.current<i)return[];const o=l.HelperUtils.GetWord(e.lineText,e.current);return L.GetLabel(t,o.leftText);case"macro":a=n.Compiler.enviroment.allMacro.get(d.key)}const c=m.Analyser.GetContent(s),p=l.HelperUtils.MatchLine(c.content);switch(p.key){case"unknow":return L.GetEmptyLineHelper(t,d,e.trigger,a);case"instruction":return L.ProcessInstruction(p.content,t,e.current,a,e.trigger);case"command":return await L.ProcessCommand(p.content,t,e.current,a,e.trigger)}return[]}static async GetFileHelper(e,t,s,n){const i=[];if(!o.FileUtils.ReadFile)return[];e=o.FileUtils.ArrangePath(e),t=o.FileUtils.ArrangePath(t);const r=await o.FileUtils.GetPathFolder(t),a=await o.FileUtils.GetFileName(n),d=await o.FileUtils.GetPathFolder(n)===r;if(e!==r){const e=new f({showText:"..",insertText:"..",index:0});e.type=g.Folder,i.push(e)}const l=await o.FileUtils.GetFolderFiles(r);for(let e=0;e<l.length;++e){if(d&&l[e].name===a||s===x.AllAsm&&"file"===l[e].type&&!l[e].name.endsWith(".asm"))continue;const t=new f({showText:""});switch(l[e].type){case"folder":t.index=C.Folder,t.type=g.Folder,t.triggerType=s;break;case"file":t.index=C.File,t.type=g.File}t.showText=l[e].name,t.insertText=l[e].name,i.push(t)}return i}static UpdateCommandCompletions(){p.Command.commandMap.forEach(((e,t)=>{let s=new f({showText:t,insertText:t.substring(1),type:g.Command});switch(t){case".INCLUDE":s.insertText=s.insertText+' "[exp]"',s.triggerType=x.AllAsm;break;case".INCBIN":s.insertText=s.insertText+' "[exp]"',s.triggerType=x.AllFile;break;case".MACRO":s.insertText=s.insertText+" [exp]\n\n.ENDM";break;case".DBG":case".DWG":case".DLG":s.insertText=s.insertText+" [exp]\n\n.ENDD";break;case".IF":case".IFDEF":case".IFNDEF":s.insertText=s.insertText+" [exp]\n\n.ENDIF";break;case".REPEAT":s.insertText=s.insertText+" [exp]\n\n.ENDR";break;case".ENUM":s.insertText=s.insertText+" [exp]\n\n.ENDE";break;case".ORG":case".BASE":case".MSG":case".DB":case".DW":case".DL":case".DEF":case".HEX":s.insertText=s.insertText+" "}s.insertText=L.ReplaceCommon(s.insertText),L.commandCompletions.push(s),u.includes(t)||L.commandNotInMacroCompletions.push(s)}))}static GetLabel(e,t,s){const i=[];s&&!t.endsWith(".")&&(s.labels.forEach((e=>{const t=new f({showText:e.token.text,index:C.Label});i.push(t)})),s.params.forEach((e=>{const t=new f({showText:e.label.token.text,index:C.Parameter,type:g.MacroParamter});i.push(t)})));const o=t.startsWith(".")?d.LabelScope.Local:d.LabelScope.Global;let r,a,c=t.lastIndexOf(".");return t=c>0?t.substring(0,c):"",o===d.LabelScope.Global?(r=n.Compiler.enviroment.labelTree.global,a=n.Compiler.enviroment.allLabel.global):(r=n.Compiler.enviroment.labelTree.local.get(e),a=n.Compiler.enviroment.allLabel.local.get(e)),r?.forEach(((e,s)=>{if(e.parent!==t)return;const n=a?.get(s);if(!n)return;const o=n.token.text.substring(c+1),r=new f({showText:o});switch(n.type){case d.LabelType.Defined:r.type=g.Defined,r.index=C.Defined;break;case d.LabelType.Label:r.type=g.Label,r.index=C.Label;break;case d.LabelType.None:r.type=g.UnknowLabel,r.index=C.UnknowLabel;break;case d.LabelType.Variable:r.type=g.Variable,r.index=C.Variable}r.comment=l.HelperUtils.FormatComment(n),i.push(r)})),i}static GetEmptyLineHelper(e,t,s,i){switch(s){case" ":case":":return[];case".":switch(t?.type){case"macro":return L.commandNotInMacroCompletions;case"dataGroup":return L.GetLabel(e,"");default:return L.commandCompletions}default:if("dataGroup"===t?.type)return L.GetLabel(e,"");{const e=[];return e.push(...L.instructionCompletions),n.Compiler.enviroment.allMacro.forEach((t=>{const s=new f({showText:t.name.text,index:C.Macro,type:g.Macro,insertText:L.ReplaceMacro(t),comment:l.HelperUtils.FormatComment({macro:t})});e.push(s)})),e}}}static ReplaceMacro(e){let t=e.name.text;if(0===e.params.size)return t;t+=" ";let s=1;return e.params.forEach((n=>{s===e.params.size&&(s=0),t+=`\${${s}:${n.label.token.text}}, `,s++})),t=t.substring(0,t.length-2),t}static ReplaceCommon(e){let t,s="";const n=/\[exp\]/g;let i=0,o=0;for(;t=n.exec(e);)s+=e.substring(i,t.index)+`$${o}`,i=t.index+t[0].length,o++;return s+=e.substring(i),s}static UpdateInstruction(){L.instructionCompletions=[],c.Platform.instructions.forEach(((e,t)=>{let s=t;1!==e.length||e[0].addressingMode||(s+="\n");const n=new f({showText:t,insertText:s,index:C.Instruction,type:g.Instruction});L.instructionCompletions.push(n)}))}static GetInstructionAddressingModes(e){const t=c.Platform.instructions.get(e.toUpperCase());if(!t)return[];const s=[];for(let e=0;e<t.length;++e){const n=new f({showText:""});n.type=g.AddressingType,t[e].addressingMode?(n.index=C.EmptyAddressing,n.showText=t[e].addressingMode,n.insertText=L.ReplaceCommon(t[e].addressingMode)):(n.index=C.EmptyAddressing,n.showText=h.Localization.GetMessage("empty addressing mode"),n.insertText="\n"),s.push(n)}return s}static ProcessInstruction(e,t,s,n,i){const o=e.main.start+e.main.length;if(s<o)return[];if(" "===i&&s===o+1)return L.GetInstructionAddressingModes(e.main.text);if(!i){const i=l.HelperUtils.GetWord(e.rest.text,s);return L.GetLabel(t,i.leftText,n)}return[]}static async ProcessCommand(e,t,s,n,i){let o,r=[];const a=e.main.text.toUpperCase();switch(a){case".INCLUDE":case".INCBIN":o=await L.ProcessInclude(".INCBIN"===a,"/"===i,e.rest,s,t),o&&(r=o);break;default:if(!i){const i=l.HelperUtils.GetWord(e.rest.text,s);r=L.GetLabel(t,i.leftText,n)}}return r}static async ProcessInclude(e,t,s,i,r){let a,d=m.Analyser.SplitComma(s);if(!d)return;if(d[0].isEmpty)return;if(a=m.Analyser.SplitComma(d[0]),!a||!a[0].text.startsWith('"')||!a[0].text.endsWith('"'))return;a[0]=a[0].Substring(1,a[0].length-2);const c=l.HelperUtils.CurrentInToken(i,...a);switch(c?.index){case 0:if(t){const t=e?x.AllFile:x.AllAsm,s=n.Compiler.enviroment.GetFilePath(r),d=await o.FileUtils.GetPathFolder(s);if(a=a[0].Substring(0,i-a[0].start-1),a=o.FileUtils.Combine(d,a.text),"path"!==await o.FileUtils.PathType(a))break;return await L.GetFileHelper(d,a,t,s)}}}}t.IntellisenseProvider=L,L.commandCompletions=[],L.commandNotInMacroCompletions=[],L.instructionCompletions=[]},481:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RenameAndReferences=void 0;const n=s(828),i=s(185),o=s(382),r=s(738),a=s(521),d=s(565);class l{static PreRename(e,t,s,n){l.ClearRename();const c=r.Compiler.enviroment.GetFileIndex(e,!1);l.SaveRename.fileIndex=c;const p=d.HelperUtils.FindMatchToken(c,t,s,n);if("number"===p.type)return a.Localization.GetMessage("rename error");if("none"===p.type&&i.LabelUtils.CheckIllegal(t.trim(),!0)&&(p.type="label",p.token=new o.Token(t,{line:s}).Trim(),!l.CheckLabelIllegal(p.token.text,!0)))return a.Localization.GetMessage("rename error");const m={start:0,length:0};switch(p.type){case"filePath":return a.Localization.GetMessage("rename error");case"label":if(!l.CheckLabelIllegal(p.token.text,!0))return a.Localization.GetMessage("rename error");m.start=p.token.start,m.length=p.token.length,l.SaveRename.token=p.token,l.SaveRename.type="label";break;case"macro":m.start=p.token.start,m.length=p.token.length,l.SaveRename.token=p.token,l.SaveRename.type="macro"}return m}static RenameLabel(e){if("none"===l.SaveRename.type)return a.Localization.GetMessage("rename error");if(!l.CheckLabelIllegal(e,"macro"!==l.SaveRename.type))return a.Localization.GetMessage("rename error");const t=new o.Token(e);if(i.LabelUtils.FindLabel(t,{fileIndex:l.SaveRename.fileIndex}))return a.Localization.GetMessage("Label {0} is already defined",e);const s=new Map;let n;switch("label"!==l.SaveRename.type&&"macroLabel"!==l.SaveRename.type||(n=i.LabelUtils.FindLabel(l.SaveRename.token,{macro:l.SaveRename.macro})),l.SaveRename.type){case"label":const e=i.LabelUtils.FindLabel(l.SaveRename.token,{macro:l.SaveRename.macro});if(e){const t=r.Compiler.enviroment.GetFilePath(e.fileIndex),n=s.get(t)??[];n.push(e.token),s.set(t,n)}break;case"macroLabel":const t=i.LabelUtils.FindLabel(l.SaveRename.token,{macro:l.SaveRename.macro});if(t){const e=r.Compiler.enviroment.GetFilePath(t.fileIndex),n=s.get(e)??[];return n.push(t.token),l.SaveLineToken(l.SaveRename.type,l.SaveRename.token.text,l.SaveRename.macro.lines,n),s.set(e,n),s}break;case"macro":const n=r.Compiler.enviroment.allMacro.get(l.SaveRename.token.text);if(n){const e=r.Compiler.enviroment.GetFilePath(n.fileIndex),t=s.get(e)??[];t.push(n.name),s.set(e,t)}}const d=r.Compiler.enviroment.allLine.keys();for(const e of d){const t=r.Compiler.enviroment.allLine.get(e),n=r.Compiler.enviroment.GetFilePath(e),i=s.get(n)??[];l.SaveLineToken(l.SaveRename.type,l.SaveRename.token.text,t,i),s.set(n,i)}return s}static ClearRename(){l.SaveRename.fileIndex=-1,l.SaveRename.type="none",l.SaveRename.token=void 0,l.SaveRename.macro=void 0}static CheckLabelIllegal(e,t){if(!i.LabelUtils.CheckIllegal(e,t))return!1;const s=e.split(".");for(let e=1;e<s.length;e++)if(!s[e])return!1;return!0}static GetReferences(e,t,s,n){const i=r.Compiler.enviroment.GetFileIndex(e,!1),o=d.HelperUtils.FindMatchToken(i,t,s,n),a=new Map;switch(o.type){case"number":case"comment":case"instruction":case"command":case"none":case"filePath":return a;case"label":case"macro":break;case"macroLabel":const e=o.tag,t=r.Compiler.enviroment.GetFilePath(i),s=a.get(t)??[];return o.type="label",l.SaveLineToken(o.type,o.token.text,e.lines,s),a.set(t,s),a}const c=r.Compiler.enviroment.allLine.keys();for(const e of c){const t=r.Compiler.enviroment.allLine.get(e),s=r.Compiler.enviroment.GetFilePath(e),n=a.get(s)??[];l.SaveLineToken(o.type,o.token.text,t,n),a.set(s,n)}return a}static SaveLineToken(e,t,s,n){for(let i=0;i<s.length;i++){const o=s[i];if(o)switch(o.key){case"macro":"macro"===e&&o.name.text===t&&n.push(o.name);break;case"instruction":"label"===e&&l.FindMatchInExpression(t,n,...o.expressions);break;case"variable":"label"===e&&l.FindMatchInExpression(t,n,o.expression);break;case"command":"label"===e&&l.GetCommandExpression(o,t,n)}}}static GetCommandExpression(e,t,s){let n;switch(e.command.text.toUpperCase()){case".DB":case".DW":case".DL":n=e.tag,l.FindMatchInExpression(t,s,...n);break;case".ORG":case".BASE":case".IF":case".ELSEIF":n=e.tag,n.exp&&l.FindMatchInExpression(t,s,n.exp);break;case".ENUM":n=e.tag,n.exp&&l.FindMatchInExpression(t,s,n.exp);for(let e=0;e<n.lines.length;e++){const i=n.lines[e];i&&l.FindMatchInExpression(t,s,i.expression)}}}static FindMatchInExpression(e,t,...s){for(let i=0;i<s.length;i++)for(let o=0;o<s[i].parts.length;o++){const r=s[i].parts[o];r.type===n.PriorityType.Level_1_Label&&r.token.text===e&&t.push(r.token)}}}t.RenameAndReferences=l,l.SaveRename={token:void 0,type:"none",macro:void 0,fileIndex:0}},634:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CommandLine=void 0;const n=s(126),i=s(770),o=s(317);class r{constructor(){this.key="command",this.arguments=[],this.lineType=i.LineType.None,this.lineResult=new i.LineResult}static Create(e,t,s){const a=new r;a.org=e,a.comment=s,a.command=t.main,a.label=o.LabelLine.Create(t.pre,s);const d=n.Command.SplitArgument(t.main,t.rest);if(d)return a.arguments=d,a;a.lineType=i.LineType.Error}}t.CommandLine=r},770:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnknowLine=t.LineResult=t.LineType=void 0;const n=s(642),i=s(382),o=s(738),r=s(521);var a;!function(e){e[e.None=0]="None",e[e.Finished=1]="Finished",e[e.Error=2]="Error",e[e.Ignore=3]="Ignore"}(a||(t.LineType=a={})),t.LineResult=class{constructor(){this.address={base:0,org:-1},this.result=[]}get resultLength(){return this.result.length}SetResult(e,t,s){let n=s,i=0;for(;n--;)this.result[t+i]=0,i++;let o=0,r=0;for(;s--;)this.result[t]=255&e,o|=this.result[t]<<r,e>>>=8,r+=8,t++;return{result:o,overflow:0!==e}}SetAddress(){if(o.Compiler.enviroment.address.org<0){const e=r.Localization.GetMessage("Unknow original address"),t=new i.Token("");n.MyDiagnostic.PushException(t,e)}this.address.org<0&&(this.address.org=o.Compiler.enviroment.address.org,this.address.base=o.Compiler.enviroment.address.base)}AddAddress(){this.address.org>=0&&(o.Compiler.enviroment.address.org=this.address.org,o.Compiler.enviroment.address.base=this.address.base),o.Compiler.enviroment.address.org+=this.resultLength,o.Compiler.enviroment.address.base+=this.resultLength}};class d{constructor(){this.key="unknow",this.lineType=a.None}static Create(e,t){const s=new d;return s.org=e,s.comment=t,s}}t.UnknowLine=d},747:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InstructionLine=void 0;const n=s(828),i=s(642),o=s(366),r=s(521),a=s(74),d=s(770),l=s(317);class c{constructor(){this.key="instruction",this.lineType=d.LineType.None,this.expressions=[],this.lineResult=new d.LineResult}static Create(e,t,s){const i=new c;i.org=e,i.instruction=t.main,i.label=l.LabelLine.Create(t.pre,s);const o=a.Platform.MatchAddressingMode(i.instruction,t.rest);if(o){i.addressMode=o.addressingMode;for(let e=0;e<o.exprs.length;e++){const t=o.exprs[e],s=n.ExpressionUtils.SplitAndSort(t);s&&(i.expressions[e]=s)}return i}}AnalyseFirst(e){this.label?.Analyse()}AnalyseThird(e){n.ExpressionUtils.CheckLabels(e,...this.expressions)}Compile(e){if(this.lineResult.SetAddress(),this.label?.Compile(e),this.addressMode?.spProcess)return this.addressMode.spProcess(e),void this.lineResult.AddAddress();if(this.lineType=d.LineType.Finished,0===this.expressions.length)return this.lineResult.SetResult(this.addressMode.opCode[0],0,this.addressMode.opCodeLength[0]),void this.lineResult.AddAddress();const t=n.ExpressionUtils.GetValue(this.expressions[0].parts,e);if(t.success){let e=o.Utils.GetNumberByteLength(t.value);if(0!==this.lineResult.resultLength)e=this.lineResult.resultLength-1;else if(!this.addressMode.opCode[e])for(let t=0;t<this.addressMode.opCode.length;++t)if(this.addressMode.opCode[t]){e=t;break}const s=this.addressMode.opCodeLength[e];this.lineResult.SetResult(this.addressMode.opCode[e],0,s);const a=this.lineResult.SetResult(t.value,s,e);if(a.overflow){const e=r.Localization.GetMessage("Expression result is {0}, but compile result is {1}",t.value,a.result),s=n.ExpressionUtils.CombineExpressionPart(this.expressions[0].parts);i.MyDiagnostic.PushWarning(s,e)}}else{const e=this.addressMode.opCode.length-1;this.lineResult.result.length=this.addressMode.opCodeLength[e]+e,this.lineType=d.LineType.None}this.lineResult.AddAddress()}}t.InstructionLine=c},317:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LabelLine=void 0;const n=s(185),i=s(738),o=s(770);class r{constructor(){this.key="label",this.lineType=o.LineType.None}static Create(e,t){const s=new r,i=e.Trim();if(!i.isEmpty)return s.labelToken=n.LabelUtils.RemoveColon(i),s.comment=t,s}Analyse(){const e=n.LabelUtils.CreateCommonLabel(this.labelToken,{comment:this.comment});e?e.type=n.LabelType.Label:this.lineType=o.LineType.Error}Compile(e){if(i.Compiler.FirstCompile()&&this.Analyse(),this.lineType===o.LineType.Finished)return;let t=n.LabelUtils.FindLabel(this.labelToken,e);t&&(t.type=n.LabelType.Label,t.value=i.Compiler.enviroment.address.org,this.lineType=o.LineType.Finished)}}t.LabelLine=r},823:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MacroLine=void 0;const n=s(738),i=s(828),o=s(642),r=s(521),a=s(958),d=s(770),l=s(735),c=s(366),p=s(317);class m{constructor(){this.key="macro",this.lineType=d.LineType.None,this.expressions=[]}static Create(e,t){const s=new m;s.label=p.LabelLine.Create(e.pre,t),s.name=e.main;const l=n.Compiler.enviroment.allMacro.get(e.main.text);s.macro=l;const c=a.Analyser.SplitComma(e.rest);if(!c){if(0!==l.params.size){const t=r.Localization.GetMessage("Macro arguments count is {0}, but got {1}",l.params.size,0);o.MyDiagnostic.PushException(e.main,t),s.lineType=d.LineType.Error}return s}if(!l.indParams&&l.params.size!==c.length||l.indParams&&c.length<l.params.size){const t=r.Localization.GetMessage("Macro arguments count is {0}, but got {1}",l.params.size,c.length);return o.MyDiagnostic.PushException(e.main,t),void(s.lineType=d.LineType.Error)}for(let e=0;e<c.length;e++){const t=i.ExpressionUtils.SplitAndSort(c[e]);if(t)s.expressions[e]=t;else{const t=r.Localization.GetMessage("Macro arguments error");o.MyDiagnostic.PushException(c[e],t),s.lineType=d.LineType.Error}}return s}static GetLineResult(e,t){const s=e.GetCurrent().macro,i=new l.CompileOption;i.allLines=s.lines,n.Compiler.GetLinesResult(i,t)}AnalyseLabel(){this.label?.Analyse()}AnalyseThird(e){for(let t=0;t<this.expressions.length;t++){const s=this.expressions[t];i.ExpressionUtils.CheckLabels(e,s)}}async Compile(e){this.label?.Compile(e),0===n.Compiler.enviroment.compileTime&&(this.macro=c.Utils.DeepClone(this.macro));let t=0;const s=this.macro.params.keys();for(const n of s){const s=this.expressions[t],o=i.ExpressionUtils.GetStringValue(s,{macro:e.macro});if(t++,!o.success)continue;const r=this.macro.params.get(n);r.values=o.values,1===o.values.length&&(r.label.value=o.values[0])}if(this.macro.indParams){let s=0;for(let n=t;n<this.expressions.length;n++){const n=this.expressions[t],o=i.ExpressionUtils.GetStringValue(n,{macro:e.macro});o.success&&(this.macro.indParams.values[s]=o.values),s++}}const o=new l.CompileOption;o.allLines=this.macro.lines,o.macro=this.macro,await n.Compiler.Compile(o)}}t.MacroLine=m},43:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VariableLine=void 0;const n=s(828),i=s(185),o=s(642),r=s(738),a=s(521),d=s(770);class l{constructor(){this.key="variable",this.lineType=d.LineType.None}static Create(e,t,s){const i=new l;if(i.org=e,i.labelToken=t.pre.Trim(),i.comment=s,t.rest.isEmpty){const e=a.Localization.GetMessage("Expression error");return o.MyDiagnostic.PushException(t.rest,e),void(i.lineType=d.LineType.Error)}const r=n.ExpressionUtils.SplitAndSort(t.rest);if(r)return i.expression=r,i;i.lineType=d.LineType.Error}AnalyseFirst(e){const t=e.GetCurrent(),s=i.LabelUtils.CreateCommonLabel(t.labelToken,{ableNameless:!1,comment:t.comment});s?(s.type=i.LabelType.Variable,s.comment=t.comment):t.lineType=d.LineType.Error}AnalyseThird(e){if(n.ExpressionUtils.CheckLabels(e,this.expression))return;const t=i.LabelUtils.FindLabel(this.labelToken);if(!t)return;const s=n.ExpressionUtils.GetValue(this.expression.parts,e);s.success&&(t.value=s.value)}Compile(e){let t;if(0===r.Compiler.enviroment.compileTime){if(t=i.LabelUtils.CreateCommonLabel(this.labelToken,{ableNameless:!1,comment:this.comment}),!t)return void(this.lineType=d.LineType.Error);t.type=i.LabelType.Variable}else t=i.LabelUtils.FindLabel(this.labelToken);if(!t)return;const s=n.ExpressionUtils.GetValue(this.expression.parts,e);s.success&&(t.value=s.value,this.lineType=d.LineType.Finished)}}t.VariableLine=l},293:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Asm6502=void 0;const n=s(828),i=s(642),o=s(521),r=s(770),a=s(74);t.Asm6502=class{constructor(){this.platformName="6502",this.Initialize()}Initialize(){let e=["TAY","TAX","TSX","TYA","TXA","TXS","PHA","PHP","PLA","PLP","INX","INY","DEX","DEY","RTI","RTS","BRK","NOP","CLC","CLI","CLD","CLV","SEC","SEI","SED"];const t=[168,170,186,152,138,154,72,8,104,40,232,200,202,136,64,96,0,234,24,88,216,184,56,120,248];for(let s=0;s<e.length;++s)this.AddInstruction(e[s],{opCode:[t[s]]});e=["LDA","LDX","LDY","STA","STX","STY","ADC","SBC","AND","EOR","ORA","CMP","CPX","CPY","BIT","INC","DEC"];let s=["#[exp]","([exp],X)","([exp]),Y","[exp],X","[exp],Y","[exp]"];const n=[[[169],[161],[177],[181,189],[-1,185],[165,173]],[[162],null,null,null,[182,190],[166,174]],[[160],null,null,[180,188],null,[164,172]],[null,[129],[145],[149,157],[-1,153],[133,141]],[null,null,null,null,[150],[134,142]],[null,null,null,[148],null,[132,140]],[[105],[97],[113],[117,125],[-1,121],[101,109]],[[233],[225],[241],[245,253],[-1,249],[229,237]],[[41],[33],[49],[53,61],[-1,57],[37,45]],[[73],[65],[81],[85,93],[-1,89],[69,77]],[[9],[1],[17],[21,29],[-1,25],[5,13]],[[201],[193],[209],[213,221],[-1,217],[197,205]],[[224],null,null,null,null,[228,236]],[[192],null,null,null,null,[196,204]],[null,null,null,null,null,[36,44]],[null,null,null,[246,254],null,[230,238]],[null,null,null,[214,222],null,[198,206]]];for(let t=0;t<e.length;++t){const i=e[t];for(let e=0;e<s.length;++e){const o=s[e],r=n[t][e];if(null===r)continue;let a=[];for(let e=0;e<r.length;++e)-1!==r[e]&&(a[e+1]=r[e]);this.AddInstruction(i,{addressingMode:o,opCode:a})}}e=["ASL","LSR","ROL","ROR"];const i=[[[10],[,22,30],[,6,14]],[[74],[,86,94],[,70,78]],[[42],[,54,62],[,38,46]],[[106],[,118,126],[,102,110]]];for(let t=0;t<e.length;++t)this.AddInstruction(e[t],{opCode:i[t][0]}),this.AddInstruction(e[t],{addressingMode:"[exp],X",opCode:i[t][1]}),this.AddInstruction(e[t],{addressingMode:"[exp]",opCode:i[t][2]});this.AddInstruction("JMP",{addressingMode:"([exp])",opCode:[,,108]}),this.AddInstruction("JMP",{addressingMode:"[exp]",opCode:[,,76]}),this.AddInstruction("JSR",{addressingMode:"[exp]",opCode:[,,32]}),e=["BPL","BMI","BVC","BVS","BCC","BCS","BNE","BEQ"];const o=[16,48,80,112,144,176,208,240];for(let t=0;t<e.length;++t)this.AddInstruction(e[t],{addressingMode:"[exp]",opCode:[,o[t]],spProcess:this.ConditionBranch})}ConditionBranch(e){const t=e.GetCurrent(),s=n.ExpressionUtils.GetValue(t.expressions[0].parts,e);if(!s.success)return void(t.lineResult.result.length=2);const a=s.value-t.lineResult.address.org-2;if(a>127||a<-128){t.lineType=r.LineType.Error;const e=o.Localization.GetMessage("Argument out of range");i.MyDiagnostic.PushException(t.instruction,e)}else t.lineResult.SetResult(t.addressMode.opCode[1],0,1),t.lineResult.SetResult(255&a,1,1),t.lineType=r.LineType.Finished}AddInstruction(e,t){a.Platform.AddInstructionWithLength(e,t)}}},163:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Asm65C816=void 0;const n=s(828),i=s(642),o=s(521),r=s(770),a=s(74);t.Asm65C816=class{constructor(){this.platformName="65c816",this.Initialize()}Initialize(){const e=["#[exp]","([exp],X)","([exp]),Y","[[exp]],Y","([exp],S),Y","[exp],S","[exp],X","[exp],Y","[[exp]]","([exp])","[exp]"];let t=[[,105,105],[,97],[,113],[,119],[,115],[,99],[,117,125,127],[,,121],[,103],[,114],[,101,109,111]];this.Add("ADC",e,t),t=[[,41,41],[,33],[,49],[,55],[,51],[,35],[,53,61,63],[,,57],[,39],[,50],[,37,45,47]],this.Add("AND",e,t),this.AddInstruction("ASL",{opCode:[10]}),this.AddInstruction("ASL",{addressingMode:"[exp],X",opCode:[,22,30]}),this.AddInstruction("ASL",{addressingMode:"[exp]",opCode:[,6,14]});const s=["BCC","BCS","BEQ","BNE","BMI","BPL","BVC","BVS","BRA"],n=[144,176,240,208,48,16,80,112];for(let e=0;e<s.length;++e)this.AddInstruction(s[e],{addressingMode:"[exp]",opCode:[,n[e]],spProcess:this.Condition});this.AddInstruction("BRL",{addressingMode:"[exp]",opCode:[,,130]}),this.AddInstruction("BIT",{addressingMode:"#[exp]",opCode:[,137,137]}),this.AddInstruction("BIT",{addressingMode:"[exp],X",opCode:[,52,60]}),this.AddInstruction("BIT",{addressingMode:"[exp]",opCode:[,36,44]}),this.AddInstruction("BRK",{opCode:[0]});const i=["CLC","CLD","CLI","CLV","SEC","SED","SEI","PHA","PHP","PHX","PHY","PLA","PLP","PLX","PLY","PHB","PHD","PHK","PLB","PLD","RTI","RTL","RTS","TAX","TAY","TXA","TYA","TSX","TXS","TXY","TYX","TCD","TDC","TCS","TSC","WAI","XBA","XCE"],o=[24,216,88,184,56,248,120,72,8,218,90,104,40,250,122,139,11,75,171,43,64,107,96,170,168,138,152,186,154,155,187,91,123,27,59,203,235,251];for(let e=0;e<i.length;e++)this.AddInstruction(i[e],{opCode:[o[e]]});t=[[,201,201],[,193],[,209],[,215],[,211],[,195],[,34,221,223],[,,217],[,199],[,210],[,197,205,207]],this.Add("CMP",e,t),this.AddInstruction("COP",{opCode:[2]}),this.AddInstruction("CPX",{addressingMode:"#[exp]",opCode:[,224,224]}),this.AddInstruction("CPX",{addressingMode:"[exp]",opCode:[,228,236]}),this.AddInstruction("CPY",{addressingMode:"#[exp]",opCode:[,192,192]}),this.AddInstruction("CPY",{addressingMode:"[exp]",opCode:[,196,204]}),this.AddInstruction("DEC",{opCode:[58]}),this.AddInstruction("DEC",{addressingMode:"[exp],X",opCode:[,214,222]}),this.AddInstruction("DEC",{addressingMode:"[exp]",opCode:[,198,206]}),this.AddInstruction("DEX",{opCode:[202]}),this.AddInstruction("DEY",{opCode:[136]}),t=[[,73,73],[,65],[,81],[,87],[,83],[,67],[,85,93,95],[,,89],[,71],[,82],[,69,77,79]],this.Add("EOR",e,t),this.AddInstruction("INC",{opCode:[26]}),this.AddInstruction("INC",{addressingMode:"[exp],X",opCode:[,246,254]}),this.AddInstruction("INC",{addressingMode:"[exp]",opCode:[,230,238]}),this.AddInstruction("INX",{opCode:[232]}),this.AddInstruction("INY",{opCode:[200]}),this.AddInstruction("JMP",{addressingMode:"([exp],X)",opCode:[,,124]}),this.AddInstruction("JMP",{addressingMode:"[[exp]]",opCode:[,,220]}),this.AddInstruction("JMP",{addressingMode:"([exp])",opCode:[,,98]}),this.AddInstruction("JMP",{addressingMode:"[exp]",opCode:[,,76,92]}),this.AddInstruction("JML",{addressingMode:"[[exp]]",opCode:[,,220]}),this.AddInstruction("JML",{addressingMode:"[exp]",opCode:[,,,92]}),this.AddInstruction("JSR",{addressingMode:"([exp],X)",opCode:[,,252]}),this.AddInstruction("JSR",{addressingMode:"[exp]",opCode:[,,32]}),this.AddInstruction("JSL",{addressingMode:"([exp],X)",opCode:[,,252]}),this.AddInstruction("JSL",{addressingMode:"[exp]",opCode:[,,,34]}),t=[[,169,169],[,161],[,177],[,183],[,179],[,163],[,181,189,191],[,,185],[,167],[,178],[,165,173,175]],this.Add("LDA",e,t),this.AddInstruction("LDX",{addressingMode:"#[exp]",opCode:[,162,162]}),this.AddInstruction("LDX",{addressingMode:"[exp],Y",opCode:[,182,190]}),this.AddInstruction("LDX",{addressingMode:"[exp]",opCode:[,166,174]}),this.AddInstruction("LDY",{addressingMode:"#[exp]",opCode:[,160,160]}),this.AddInstruction("LDY",{addressingMode:"[exp],X",opCode:[,180,188]}),this.AddInstruction("LDY",{addressingMode:"[exp]",opCode:[,164,172]}),this.AddInstruction("LSR",{opCode:[74]}),this.AddInstruction("LSR",{addressingMode:"[exp],X",opCode:[,86,94]}),this.AddInstruction("LSR",{addressingMode:"[exp]",opCode:[,70,78]}),this.AddInstruction("MVN",{addressingMode:"[exp],[exp]",opCode:[,,84],spProcess:this.Move}),this.AddInstruction("MVP",{addressingMode:"[exp],[exp]",opCode:[,,68],spProcess:this.Move}),this.AddInstruction("NOP",{opCode:[234]}),t=[[,9,9],[,1],[,17],[,23],[,19],[,3],[,21,29,31],[,,25],[,7],[,18],[,5,13,15]],this.Add("ORA",e,t),this.AddInstruction("PEA",{addressingMode:"#[exp]",opCode:[,,244]}),this.AddInstruction("PEA",{addressingMode:"[exp]",opCode:[,,244]}),this.AddInstruction("PEI",{addressingMode:"([exp])",opCode:[,212]}),this.AddInstruction("PER",{addressingMode:"[exp]",opCode:[,,98]}),this.AddInstruction("REP",{addressingMode:"#[exp]",opCode:[,194]}),this.AddInstruction("ROL",{opCode:[42]}),this.AddInstruction("ROL",{addressingMode:"[exp],X",opCode:[,54,62]}),this.AddInstruction("ROL",{addressingMode:"[exp]",opCode:[,38,46]}),this.AddInstruction("ROR",{opCode:[106]}),this.AddInstruction("ROR",{addressingMode:"[exp],X",opCode:[,118,126]}),this.AddInstruction("ROR",{addressingMode:"[exp]",opCode:[,102,110]}),t=[[,233,233],[,225],[,241],[,247],[,243],[,227],[,245,253,255],[,,249],[,231],[,242],[,229,237,239]],this.Add("SBC",e,t),this.AddInstruction("SEP",{addressingMode:"#[exp]",opCode:[,226]}),t=[void 0,[,129],[,145],[,151],[,147],[,131],[,149,157,159],[,,153],[,135],[,146],[,133,141,143]],this.Add("STA",e,t),this.AddInstruction("STP",{opCode:[219]}),this.AddInstruction("STX",{addressingMode:"[exp],Y",opCode:[,150]}),this.AddInstruction("STX",{addressingMode:"[exp]",opCode:[,134,142]}),this.AddInstruction("STY",{addressingMode:"[exp],X",opCode:[,148]}),this.AddInstruction("STY",{addressingMode:"[exp]",opCode:[,132,140]}),this.AddInstruction("STZ",{addressingMode:"[exp],X",opCode:[,116,158]}),this.AddInstruction("STZ",{addressingMode:"[exp]",opCode:[,100,156]}),this.AddInstruction("TRB",{addressingMode:"[exp]",opCode:[,20,28]}),this.AddInstruction("TSB",{addressingMode:"[exp]",opCode:[,4,12]})}Add(e,t,s){for(let n=0;n<t.length;++n){let i=s[n];i&&this.AddInstruction(e,{addressingMode:t[n],opCode:i})}}AddInstruction(e,t){a.Platform.AddInstructionWithLength(e,t)}Condition(e){const t=e.GetCurrent(),s=n.ExpressionUtils.GetValue(t.expressions[0].parts,e);if(!s.success)return void(t.lineResult.result.length=2);const a=s.value-t.lineResult.address.org-2;if(a>127||a<-128){t.lineType=r.LineType.Error;const e=o.Localization.GetMessage("Argument out of range");i.MyDiagnostic.PushException(t.instruction,e)}else t.lineResult.SetResult(t.addressMode.opCode[1],0,1),t.lineResult.SetResult(255&a,1,1),t.lineType=r.LineType.Finished}Move(e){const t=e.GetCurrent(),s=n.ExpressionUtils.GetValue(t.expressions[0].parts,e),r=n.ExpressionUtils.GetValue(t.expressions[1].parts,e);if(t.lineResult.result.length=3,!s.success||!r.success)return;let a=t.lineResult.SetResult(t.addressMode.opCode[2],0,1);if(a.overflow){const e=o.Localization.GetMessage("Expression result is {0}, but compile result is {1}",s.value,a.result),r=n.ExpressionUtils.CombineExpressionPart(t.expressions[0].parts);i.MyDiagnostic.PushWarning(r,e)}if(a=t.lineResult.SetResult(s.value,1,1),a.overflow){const e=o.Localization.GetMessage("Expression result is {0}, but compile result is {1}",r.value,a.result),s=n.ExpressionUtils.CombineExpressionPart(t.expressions[0].parts);i.MyDiagnostic.PushWarning(s,e)}t.lineResult.SetResult(r.value,2,1)}}},335:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AsmSPC700=void 0;const n=s(828),i=s(521),o=s(642),r=s(770),a=s(74);t.AsmSPC700=class{constructor(){this.platformName="SPC700",this.Initialize()}Initialize(){this.Add("ADC",{addressingMode:"(X),(Y)",opCode:[153]}),this.Add("ADC",{addressingMode:"(X)",opCode:[134]}),this.Add("ADC",{addressingMode:"[[exp],X]",opCode:[,135]}),this.Add("ADC",{addressingMode:"[[exp]],Y",opCode:[,151]}),this.Add("ADC",{addressingMode:"[exp],X",opCode:[,148,149]}),this.Add("ADC",{addressingMode:"[exp],Y",opCode:[,,150]}),this.Add("ADC",{addressingMode:"[exp],#[exp]",opCode:[,,152],spProcess:this.TwoOperands}),this.Add("ADC",{addressingMode:"[exp],[exp]",opCode:[,,137],spProcess:this.TwoOperands}),this.Add("ADC",{addressingMode:"#[exp]",opCode:[,136]}),this.Add("ADC",{addressingMode:"[exp]",opCode:[,132,133]}),this.Add("ADW",{addressingMode:"[exp]",opCode:[,122]}),this.Add("AND",{addressingMode:"(X),(Y)",opCode:[57]}),this.Add("AND",{addressingMode:"(X)",opCode:[38]}),this.Add("AND",{addressingMode:"[[exp],X]",opCode:[,39]}),this.Add("AND",{addressingMode:"[[exp]],Y",opCode:[,55]}),this.Add("AND",{addressingMode:"[exp],X",opCode:[,52,53]}),this.Add("AND",{addressingMode:"[exp],Y",opCode:[,,54]}),this.Add("AND",{addressingMode:"[exp],#[exp]",opCode:[,,56],spProcess:this.TwoOperands}),this.Add("AND",{addressingMode:"[exp],[exp]",opCode:[,,41],spProcess:this.TwoOperands}),this.Add("AND",{addressingMode:"#[exp]",opCode:[,40]}),this.Add("AND",{addressingMode:"[exp]",opCode:[,36,25]}),this.Add("ANDC",{addressingMode:"/[exp].[exp]",opCode:[,,106],spProcess:this.Bit_15_3}),this.Add("ANDC",{addressingMode:"[exp].[exp]",opCode:[,,74],spProcess:this.Bit_15_3}),this.Add("ASL",{addressingMode:"A",opCode:[28]}),this.Add("ASL",{addressingMode:"[exp],X",opCode:[,27]}),this.Add("ASL",{addressingMode:"[exp]",opCode:[,11,12]}),this.Add("ASL",{addressingMode:"",opCode:[28]}),this.Add("BBC",{addressingMode:"[exp].0,[exp]",opCode:[,,19],spProcess:this.Branch2}),this.Add("BBC",{addressingMode:"[exp].1,[exp]",opCode:[,,51],spProcess:this.Branch2}),this.Add("BBC",{addressingMode:"[exp].2,[exp]",opCode:[,,83],spProcess:this.Branch2}),this.Add("BBC",{addressingMode:"[exp].3,[exp]",opCode:[,,115],spProcess:this.Branch2}),this.Add("BBC",{addressingMode:"[exp].4,[exp]",opCode:[,,147],spProcess:this.Branch2}),this.Add("BBC",{addressingMode:"[exp].5,[exp]",opCode:[,,179],spProcess:this.Branch2}),this.Add("BBC",{addressingMode:"[exp].6,[exp]",opCode:[,,211],spProcess:this.Branch2}),this.Add("BBC",{addressingMode:"[exp].7,[exp]",opCode:[,,243],spProcess:this.Branch2}),this.Add("BBS",{addressingMode:"[exp].0,[exp]",opCode:[,,3],spProcess:this.Branch2}),this.Add("BBS",{addressingMode:"[exp].1,[exp]",opCode:[,,35],spProcess:this.Branch2}),this.Add("BBS",{addressingMode:"[exp].2,[exp]",opCode:[,,67],spProcess:this.Branch2}),this.Add("BBS",{addressingMode:"[exp].3,[exp]",opCode:[,,99],spProcess:this.Branch2}),this.Add("BBS",{addressingMode:"[exp].4,[exp]",opCode:[,,131],spProcess:this.Branch2}),this.Add("BBS",{addressingMode:"[exp].5,[exp]",opCode:[,,163],spProcess:this.Branch2}),this.Add("BBS",{addressingMode:"[exp].6,[exp]",opCode:[,,195],spProcess:this.Branch2}),this.Add("BBS",{addressingMode:"[exp].7,[exp]",opCode:[,,227],spProcess:this.Branch2}),this.Add("BCC",{addressingMode:"[exp]",opCode:[,144],spProcess:this.Branch1}),this.Add("BCS",{addressingMode:"[exp]",opCode:[,176],spProcess:this.Branch1}),this.Add("BEQ",{addressingMode:"[exp]",opCode:[,240],spProcess:this.Branch1}),this.Add("BMI",{addressingMode:"[exp]",opCode:[,48],spProcess:this.Branch1}),this.Add("BNE",{addressingMode:"[exp]",opCode:[,208],spProcess:this.Branch1}),this.Add("BPL",{addressingMode:"[exp]",opCode:[,16],spProcess:this.Branch1}),this.Add("BVC",{addressingMode:"[exp]",opCode:[,80],spProcess:this.Branch1}),this.Add("BVS",{addressingMode:"[exp]",opCode:[,112],spProcess:this.Branch1}),this.Add("BRA",{addressingMode:"[exp]",opCode:[,47],spProcess:this.Branch1}),this.Add("CBNE",{addressingMode:"[exp],X,[exp]",opCode:[,,222],spProcess:this.Branch2}),this.Add("CBNE",{addressingMode:"[exp],[exp]",opCode:[,,46],spProcess:this.Branch2}),this.Add("JMP",{addressingMode:"[[exp],X]",opCode:[,,31]}),this.Add("JMP",{addressingMode:"[exp]",opCode:[,,95]}),this.Add("JSP",{addressingMode:"[exp]",opCode:[,79],spProcess:this.JSP}),this.Add("JSR",{addressingMode:"[exp]",opCode:[,,63]}),this.Add("CLR1",{addressingMode:"[exp].0",opCode:[,18]}),this.Add("CLR1",{addressingMode:"[exp].1",opCode:[,50]}),this.Add("CLR1",{addressingMode:"[exp].2",opCode:[,82]}),this.Add("CLR1",{addressingMode:"[exp].3",opCode:[,114]}),this.Add("CLR1",{addressingMode:"[exp].4",opCode:[,146]}),this.Add("CLR1",{addressingMode:"[exp].5",opCode:[,178]}),this.Add("CLR1",{addressingMode:"[exp].6",opCode:[,210]}),this.Add("CLR1",{addressingMode:"[exp].7",opCode:[,242]}),this.Add("CLR1",{addressingMode:"[exp]",opCode:[,,78]}),this.Add("SET1",{addressingMode:"[exp].0",opCode:[,2]}),this.Add("SET1",{addressingMode:"[exp].1",opCode:[,34]}),this.Add("SET1",{addressingMode:"[exp].2",opCode:[,66]}),this.Add("SET1",{addressingMode:"[exp].3",opCode:[,98]}),this.Add("SET1",{addressingMode:"[exp].4",opCode:[,130]}),this.Add("SET1",{addressingMode:"[exp].5",opCode:[,162]}),this.Add("SET1",{addressingMode:"[exp].6",opCode:[,194]}),this.Add("SET1",{addressingMode:"[exp].7",opCode:[,226]}),this.Add("SET1",{addressingMode:"[exp]",opCode:[,,14]}),this.Add("CMP",{addressingMode:"(X),(Y)",opCode:[121]}),this.Add("CMP",{addressingMode:"(X)",opCode:[102]}),this.Add("CMP",{addressingMode:"[[exp],X]",opCode:[,103]}),this.Add("CMP",{addressingMode:"[[exp]],Y",opCode:[,119]}),this.Add("CMP",{addressingMode:"[exp],X",opCode:[,116,117]}),this.Add("CMP",{addressingMode:"[exp],Y",opCode:[,,118]}),this.Add("CMP",{addressingMode:"[exp],#[exp]",opCode:[,,120],spProcess:this.TwoOperands}),this.Add("CMP",{addressingMode:"[exp],[exp]",opCode:[,,105],spProcess:this.TwoOperands}),this.Add("CMP",{addressingMode:"#[exp]",opCode:[,104]}),this.Add("CMP",{addressingMode:"[exp]",opCode:[,100,101]}),this.Add("CPW",{addressingMode:"[exp]",opCode:[,90]}),this.Add("CPX",{addressingMode:"#[exp]",opCode:[,200]}),this.Add("CPX",{addressingMode:"[exp]",opCode:[,62,30]}),this.Add("CPY",{addressingMode:"#[exp]",opCode:[,173]}),this.Add("CPY",{addressingMode:"[exp]",opCode:[,126,94]}),this.Add("DBNZ",{addressingMode:"Y,[exp]",opCode:[,254],spProcess:this.Branch1}),this.Add("DBNZ",{addressingMode:"[exp],[exp]",opCode:[,,110],spProcess:this.Branch2}),this.Add("DEC",{addressingMode:"A",opCode:[156]}),this.Add("DEC",{addressingMode:"[exp],X",opCode:[,155]}),this.Add("DEC",{addressingMode:"[exp]",opCode:[,139,140]}),this.Add("DEC",{addressingMode:"",opCode:[156]}),this.Add("DEW",{addressingMode:"[exp]",opCode:[,26]}),this.Add("EOR",{addressingMode:"(X),(Y)",opCode:[89]}),this.Add("EOR",{addressingMode:"(X)",opCode:[70]}),this.Add("EOR",{addressingMode:"[[exp],X]",opCode:[,71]}),this.Add("EOR",{addressingMode:"[[exp]],Y",opCode:[,87]}),this.Add("EOR",{addressingMode:"[exp],X",opCode:[,84,85]}),this.Add("EOR",{addressingMode:"[exp],Y",opCode:[,,86]}),this.Add("EOR",{addressingMode:"[exp],#[exp]",opCode:[,,88],spProcess:this.TwoOperands}),this.Add("EOR",{addressingMode:"[exp],[exp]",opCode:[,,73],spProcess:this.TwoOperands}),this.Add("EOR",{addressingMode:"#[exp]",opCode:[,72]}),this.Add("EOR",{addressingMode:"[exp]",opCode:[,68,69]}),this.Add("EORC",{addressingMode:"[exp].[exp]",opCode:[,,138],spProcess:this.Bit_15_3}),this.Add("INC",{addressingMode:"A",opCode:[188]}),this.Add("INC",{addressingMode:"[exp],X",opCode:[,187]}),this.Add("INC",{addressingMode:"[exp]",opCode:[,171,172]}),this.Add("INC",{addressingMode:"",opCode:[188]}),this.Add("INW",{addressingMode:"[exp]",opCode:[,58]}),this.Add("LDA",{addressingMode:"(X)+",opCode:[191]}),this.Add("LDA",{addressingMode:"(X)",opCode:[230]}),this.Add("LDA",{addressingMode:"[[exp],X]",opCode:[,231]}),this.Add("LDA",{addressingMode:"[[exp]],Y",opCode:[,247]}),this.Add("LDA",{addressingMode:"[exp],X",opCode:[,244,245]}),this.Add("LDA",{addressingMode:"[exp],Y",opCode:[,,246]}),this.Add("LDA",{addressingMode:"#[exp]",opCode:[,232]}),this.Add("LDA",{addressingMode:"[exp]",opCode:[,228,229]}),this.Add("LDC",{addressingMode:"[exp].[exp]",opCode:[,,170],spProcess:this.Bit_15_3}),this.Add("LDW",{addressingMode:"[exp]",opCode:[,186]}),this.Add("LDX",{addressingMode:"[exp],Y",opCode:[,249]}),this.Add("LDX",{addressingMode:"#[exp]",opCode:[,205]}),this.Add("LDX",{addressingMode:"[exp]",opCode:[,248,233]}),this.Add("LDY",{addressingMode:"[exp],X",opCode:[,251]}),this.Add("LDY",{addressingMode:"#[exp]",opCode:[,141]}),this.Add("LDY",{addressingMode:"[exp]",opCode:[,235,236]}),this.Add("LSR",{addressingMode:"A",opCode:[92]}),this.Add("LSR",{addressingMode:"[exp],X",opCode:[,91]}),this.Add("LSR",{addressingMode:"[exp]",opCode:[,75,76]}),this.Add("LSR",{addressingMode:"",opCode:[92]}),this.Add("MOV",{addressingMode:"[exp],#[exp]",opCode:[,,143],spProcess:this.TwoOperands}),this.Add("MOV",{addressingMode:"[exp],[exp]",opCode:[,,250],spProcess:this.TwoOperands}),this.Add("NOT",{addressingMode:"[exp].[exp]",opCode:[,,234],spProcess:this.Bit_15_3}),this.Add("OR",{addressingMode:"[exp],#[exp]",opCode:[,,24],spProcess:this.TwoOperands}),this.Add("OR",{addressingMode:"[exp],[exp]",opCode:[,,9],spProcess:this.TwoOperands}),this.Add("OR",{addressingMode:"(X),(Y)",opCode:[25]}),this.Add("ORA",{addressingMode:"(X),(Y)",opCode:[25]}),this.Add("ORA",{addressingMode:"(X)",opCode:[6]}),this.Add("ORA",{addressingMode:"[[exp],X]",opCode:[,7]}),this.Add("ORA",{addressingMode:"[[exp]],Y",opCode:[,23]}),this.Add("ORA",{addressingMode:"[exp],X",opCode:[,20,21]}),this.Add("ORA",{addressingMode:"[exp],Y",opCode:[,,22]}),this.Add("ORA",{addressingMode:"#[exp]",opCode:[,8]}),this.Add("ORA",{addressingMode:"[exp]",opCode:[,4,5]}),this.Add("ORC",{addressingMode:"/[exp].[exp]",opCode:[,,42],spProcess:this.Bit_15_3}),this.Add("ORC",{addressingMode:"[exp].[exp]",opCode:[,,10],spProcess:this.Bit_15_3}),this.Add("ROL",{addressingMode:"A",opCode:[60]}),this.Add("ROL",{addressingMode:"[exp],X",opCode:[,59]}),this.Add("ROL",{addressingMode:"[exp]",opCode:[,43,44]}),this.Add("ROL",{addressingMode:"",opCode:[60]}),this.Add("ROR",{addressingMode:"A",opCode:[124]}),this.Add("ROR",{addressingMode:"[exp],X",opCode:[,123]}),this.Add("ROR",{addressingMode:"[exp]",opCode:[,107,108]}),this.Add("ROR",{addressingMode:"",opCode:[124]}),this.Add("SBC",{addressingMode:"(X),(Y)",opCode:[185]}),this.Add("SBC",{addressingMode:"(X)",opCode:[166]}),this.Add("SBC",{addressingMode:"[[exp],X]",opCode:[,167]}),this.Add("SBC",{addressingMode:"[[exp]],Y",opCode:[,183]}),this.Add("SBC",{addressingMode:"[exp],X",opCode:[,180,181]}),this.Add("SBC",{addressingMode:"[exp],Y",opCode:[,,182]}),this.Add("SBC",{addressingMode:"[exp],#[exp]",opCode:[,,184],spProcess:this.TwoOperands}),this.Add("SBC",{addressingMode:"[exp],[exp]",opCode:[,,169],spProcess:this.TwoOperands}),this.Add("SBC",{addressingMode:"#[exp]",opCode:[,168]}),this.Add("SBC",{addressingMode:"[exp]",opCode:[,164,165]}),this.Add("SBW",{addressingMode:"[exp]",opCode:[,154]}),this.Add("STA",{addressingMode:"(X)+",opCode:[175]}),this.Add("STA",{addressingMode:"(X)",opCode:[198]}),this.Add("STA",{addressingMode:"[[exp],X]",opCode:[,199]}),this.Add("STA",{addressingMode:"[[exp]],Y",opCode:[,215]}),this.Add("STA",{addressingMode:"[exp],X",opCode:[,212,213]}),this.Add("STA",{addressingMode:"[exp],Y",opCode:[,,214]}),this.Add("STA",{addressingMode:"[exp]",opCode:[,196,197]}),this.Add("STC",{addressingMode:"[exp].[exp]",opCode:[,,202],spProcess:this.Bit_15_3}),this.Add("STW",{addressingMode:"[exp]",opCode:[,218]}),this.Add("STX",{addressingMode:"[exp],Y",opCode:[,217]}),this.Add("STX",{addressingMode:"[exp]",opCode:[,216,201]}),this.Add("STY",{addressingMode:"[exp],X",opCode:[,219]}),this.Add("STY",{addressingMode:"[exp]",opCode:[,203,204]}),this.Add("NOP",{addressingMode:"",opCode:[0]}),this.Add("PHA",{addressingMode:"",opCode:[45]}),this.Add("PHP",{addressingMode:"",opCode:[13]}),this.Add("PHX",{addressingMode:"",opCode:[77]}),this.Add("PHY",{addressingMode:"",opCode:[109]}),this.Add("PLA",{addressingMode:"",opCode:[174]}),this.Add("PLP",{addressingMode:"",opCode:[142]}),this.Add("PLX",{addressingMode:"",opCode:[206]}),this.Add("PLY",{addressingMode:"",opCode:[238]}),this.Add("RTI",{addressingMode:"",opCode:[127]}),this.Add("RTS",{addressingMode:"",opCode:[111]}),this.Add("SEC",{addressingMode:"",opCode:[128]}),this.Add("SEI",{addressingMode:"",opCode:[192]}),this.Add("SEI",{addressingMode:"",opCode:[192]}),this.Add("SEP",{addressingMode:"",opCode:[64]}),this.Add("CLC",{addressingMode:"",opCode:[96]}),this.Add("CLI",{addressingMode:"",opCode:[160]}),this.Add("CLP",{addressingMode:"",opCode:[32]}),this.Add("CLV",{addressingMode:"",opCode:[224]}),this.Add("TAX",{addressingMode:"",opCode:[93]}),this.Add("TAY",{addressingMode:"",opCode:[253]}),this.Add("TSX",{addressingMode:"",opCode:[157]}),this.Add("TXA",{addressingMode:"",opCode:[125]}),this.Add("TXS",{addressingMode:"",opCode:[189]}),this.Add("TYA",{addressingMode:"",opCode:[221]}),this.Add("WAI",{addressingMode:"",opCode:[239]}),this.Add("XCN",{addressingMode:"A",opCode:[159]}),this.Add("XCN",{addressingMode:"",opCode:[159]}),this.Add("DAA",{addressingMode:"A",opCode:[223]}),this.Add("DAA",{addressingMode:"",opCode:[223]}),this.Add("DAS",{addressingMode:"A",opCode:[190]}),this.Add("DAS",{addressingMode:"",opCode:[190]}),this.Add("STP",{addressingMode:"",opCode:[255]}),this.Add("DEX",{addressingMode:"",opCode:[29]}),this.Add("DEY",{addressingMode:"",opCode:[220]}),this.Add("INX",{addressingMode:"",opCode:[61]}),this.Add("INY",{addressingMode:"",opCode:[252]}),this.Add("DIV",{addressingMode:"YA,X",opCode:[158]}),this.Add("DIV",{addressingMode:"",opCode:[158]}),this.Add("MUL",{addressingMode:"YA",opCode:[207]}),this.Add("MUL",{addressingMode:"",opCode:[207]}),this.Add("JST0",{addressingMode:"",opCode:[1]}),this.Add("JST1",{addressingMode:"",opCode:[17]}),this.Add("JST2",{addressingMode:"",opCode:[33]}),this.Add("JST3",{addressingMode:"",opCode:[49]}),this.Add("JST4",{addressingMode:"",opCode:[65]}),this.Add("JST5",{addressingMode:"",opCode:[81]}),this.Add("JST6",{addressingMode:"",opCode:[97]}),this.Add("JST7",{addressingMode:"",opCode:[113]}),this.Add("JST8",{addressingMode:"",opCode:[129]}),this.Add("JST9",{addressingMode:"",opCode:[145]}),this.Add("JSTA",{addressingMode:"",opCode:[161]}),this.Add("JSTB",{addressingMode:"",opCode:[177]}),this.Add("JSTC",{addressingMode:"",opCode:[193]}),this.Add("JSTD",{addressingMode:"",opCode:[209]}),this.Add("JSTE",{addressingMode:"",opCode:[225]}),this.Add("JSTF",{addressingMode:"",opCode:[241]}),this.Add("NOTC",{addressingMode:"",opCode:[237]})}TwoOperands(e){const t=e.GetCurrent(),s=n.ExpressionUtils.GetValue(t.expressions[1].parts,e),r=n.ExpressionUtils.GetValue(t.expressions[1].parts,e);if(t.lineResult.result.length=3,!s.success||!r.success)return;t.lineResult.SetResult(t.addressMode.opCode[2],0,1);let a=t.lineResult.SetResult(s.value,1,1);if(a.overflow){const e=i.Localization.GetMessage("Expression result is {0}, but compile result is {1}",s.value,a.result),r=n.ExpressionUtils.CombineExpressionPart(t.expressions[0].parts);o.MyDiagnostic.PushWarning(r,e)}if(a=t.lineResult.SetResult(s.value,1,1),a.overflow){const e=i.Localization.GetMessage("Expression result is {0}, but compile result is {1}",r.value,a.result),s=n.ExpressionUtils.CombineExpressionPart(t.expressions[1].parts);o.MyDiagnostic.PushWarning(s,e)}}Branch1(e){const t=e.GetCurrent(),s=n.ExpressionUtils.GetValue(t.expressions[0].parts,e);if(!s.success)return void(t.lineResult.result.length=2);const a=s.value-t.lineResult.address.org-2;if(a>127||a<-128){t.lineType=r.LineType.Error;let e=i.Localization.GetMessage("Argument out of range");o.MyDiagnostic.PushException(t.instruction,e)}else t.lineResult.SetResult(t.addressMode.opCode[1],0,1),t.lineResult.SetResult(255&a,1,1),t.lineType=r.LineType.Finished}Branch2(e){const t=e.GetCurrent(),s=n.ExpressionUtils.GetValue(t.expressions[1].parts,e),a=n.ExpressionUtils.GetValue(t.expressions[0].parts,e).value;if(!s.success)return void(t.lineResult.result.length=3);const d=s.value-t.lineResult.address.org-3;if(d>127||d<-128){t.lineType=r.LineType.Error;let e=i.Localization.GetMessage("Argument out of range");o.MyDiagnostic.PushException(t.instruction,e)}else t.lineResult.SetResult(t.addressMode.opCode[2],0,1),t.lineResult.SetResult(a,1,1),t.lineResult.SetResult(255&d,2,1),t.lineType=r.LineType.Finished}Bit_15_3(e){const t=e.GetCurrent(),s=n.ExpressionUtils.GetValue(t.expressions[0].parts,e),a=n.ExpressionUtils.GetValue(t.expressions[1].parts,e).value;if(!s.success)return void(t.lineResult.result.length=3);const d=s.value;if(d>8191||d<0||a>7||a<0){t.lineType=r.LineType.Error;let e=i.Localization.GetMessage("Argument out of range");return void o.MyDiagnostic.PushException(t.instruction,e)}let l=(a<<5)+(d>>8),c=255&d;t.lineResult.SetResult(t.addressMode.opCode[2],0,1),t.lineResult.SetResult(l,2,1),t.lineResult.SetResult(c,1,1),t.lineType=r.LineType.Finished}JSP(e){const t=e.GetCurrent(),s=n.ExpressionUtils.GetValue(t.expressions[0].parts,e);if(!s.success)return void(t.lineResult.result.length=2);let a=s.value;if(a>65535||a<65280){t.lineType=r.LineType.Error;let e=i.Localization.GetMessage("Argument out of range");o.MyDiagnostic.PushException(t.instruction,e)}else a&=255,t.lineResult.SetResult(t.addressMode.opCode[1],0,1),t.lineResult.SetResult(255&a,1,1),t.lineType=r.LineType.Finished}Add(e,t){a.Platform.AddInstructionWithLength(e,t)}}},258:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AsmZ80_GB=void 0;const n=s(74);t.AsmZ80_GB=class{constructor(){this.platformName="z80-gb",this.Initialize()}Initialize(){const e=[6,14,22,30,38,46];for(let t=0;t<6;++t)this.AddInstruction("LD",{addressingMode:`${"BCDEHL"[t]},[exp]`,opCode:[,e[t]]});const t=["A","B","C","D","E","H","L","(HL)"],s=[[127,120,121,122,123,124,125,126],[71,64,65,66,67,68,69,70],[79,72,73,74,75,76,77,78],[87,80,81,82,83,84,85,86],[95,88,89,90,91,92,93,94],[103,96,97,98,99,100,101,102],[111,104,105,106,107,108,109,110]];for(let e=0;e<t.length-1;++e)for(let n=0;n<t.length;++n){let i=`${t[e]},${t[n]}`;this.AddInstruction("LD",{addressingMode:i,opCode:[s[e][n]]})}this.A_AddressingMode(["(BC)","(DE)","(HL)","(C)"],[10,26,126,242],[2,18,119,226]),this.A_AddressingMode(["(HLD)","(HL-)"],[58,58],[50,50]),this.AddInstruction("LDD",{addressingMode:"A,(HL)",opCode:[,58]}),this.AddInstruction("LDD",{addressingMode:"(HL),A",opCode:[,50]}),this.A_AddressingMode(["(HLI)","(HL+)"],[42,42],[34,34]),this.AddInstruction("LDI",{addressingMode:"A,(HL)",opCode:[,42]}),this.AddInstruction("LDI",{addressingMode:"(HL),A",opCode:[,34]}),this.AddInstruction("LDH",{addressingMode:"([exp]),A",opCode:[224]}),this.AddInstruction("LDH",{addressingMode:"A,([exp])",opCode:[240]}),this.AddInstruction("LD",{addressingMode:"BC,[exp]",opCode:[,,1]}),this.AddInstruction("LD",{addressingMode:"DE,[exp]",opCode:[,,17]}),this.AddInstruction("LD",{addressingMode:"HL,[exp]",opCode:[,,33]}),this.AddInstruction("LD",{addressingMode:"SP,[exp]",opCode:[,,49]}),this.AddInstruction("LD",{addressingMode:"SP,HL",opCode:[249]}),this.AddInstruction("LDHL",{addressingMode:"SP,[exp]",opCode:[,248]}),this.AddInstruction("LD",{addressingMode:"([exp]),SP",opCode:[,,8]}),this.AddInstruction("LD",{addressingMode:"([exp]),A",opCode:[,,234]}),this.AddInstruction("LD",{addressingMode:"A,([exp])",opCode:[,,250]});{const e=["AF","BC","DE","HL"],t=[245,197,213,229],s=[241,193,209,225];for(let n=0;n<e.length;++n)this.AddInstruction("PUSH",{addressingMode:e[n],opCode:[t[n]]}),this.AddInstruction("POP",{addressingMode:e[n],opCode:[s[n]]})}this.StartToA("ADD",128,198),this.StartToA("ADC",136,206),this.StartToA("SUB",144,214),this.StartToA("SBC",152,222),this.OpCodeOneIncrement("AND",160,230),this.OpCodeOneIncrement("OR",176,246),this.OpCodeOneIncrement("XOR",168,238),this.OpCodeOneIncrement("CP",184,254),this.Single("INC",["B","C","D","E","H","L","(HL)","A"],[4,12,20,28,36,44,52,60]),this.Single("INC",["BC","DE","HL","SP"],[3,19,35,51]),this.Single("DEC",["B","C","D","E","H","L","(HL)","A"],[5,13,21,29,37,45,53,61]),this.Single("DEC",["BC","DE","HL","SP"],[11,27,43,59]),this.Combine("ADD","HL",["BC","DE","HL","SP"],[9,25,41,57]),this.AddInstruction("ADD",{addressingMode:"SP,#[exp]",opCode:[,232]}),this.Single("SWAP",["B","C","D","E","H","L","(HL)","A"],[12491,12747,13003,13259,13515,13771,14027,14283]),this.AddInstruction("STOP",{opCode:[16],opCodeLength:[2]}),this.NoAddModes([["DAA",39],["CPL",47],["CCF",63],["SCF",55],["NOP",0],["HALT",118],["DI",243],["EI",251],["RLCA",7],["RLA",23],["RRCA",15],["RRA",31]]),this.OpCodeTwoIncrement([["RLC",203],["RL",4299],["RRC",2251],["RR",6347],["SLA",8395],["SRA",10443],["SRL",14539]]),this.Combine("BIT","[exp]",["B","C","D","E","H","L","(HL)","A"],[16587,16843,17099,17355,17611,17867,18123,18379]),this.Combine("SET","[exp]",["B","C","D","E","H","L","(HL)","A"],[49355,49611,49867,50123,50379,50635,50891,51147]),this.Combine("RES","[exp]",["B","C","D","E","H","L","(HL)","A"],[32971,33227,33483,33739,33995,34251,34507,34763]),this.AddInstruction("JP",{addressingMode:"(HL)",opCode:[233]}),this.AddInstruction("JP",{addressingMode:"NZ,[exp]",opCode:[,,194]}),this.AddInstruction("JP",{addressingMode:"Z,[exp]",opCode:[,,202]}),this.AddInstruction("JP",{addressingMode:"NC,[exp]",opCode:[,,210]}),this.AddInstruction("JP",{addressingMode:"C,[exp]",opCode:[,,218]}),this.AddInstruction("JP",{addressingMode:"[exp]",opCode:[,,195]}),this.AddInstruction("JR",{addressingMode:"NZ,[exp]",opCode:[,32]}),this.AddInstruction("JR",{addressingMode:"Z,[exp]",opCode:[,40]}),this.AddInstruction("JR",{addressingMode:"NC,[exp]",opCode:[,48]}),this.AddInstruction("JR",{addressingMode:"C,[exp]",opCode:[,56]}),this.AddInstruction("JR",{addressingMode:"[exp]",opCode:[,24]}),this.AddInstruction("CALL",{addressingMode:"NZ,[exp]",opCode:[,,196]}),this.AddInstruction("CALL",{addressingMode:"Z,[exp]",opCode:[,,204]}),this.AddInstruction("CALL",{addressingMode:"NC,[exp]",opCode:[,,212]}),this.AddInstruction("CALL",{addressingMode:"C,[exp]",opCode:[,,220]}),this.AddInstruction("CALL",{addressingMode:"[exp]",opCode:[,,205]});for(let e=0;e<8;++e)this.AddInstruction("RST",{addressingMode:`${(e<<3).toString(16)}H`,opCode:[199+(e<<3)]});this.AddInstruction("RET",{addressingMode:"NZ",opCode:[192]}),this.AddInstruction("RET",{addressingMode:"Z",opCode:[200]}),this.AddInstruction("RET",{addressingMode:"NC",opCode:[208]}),this.AddInstruction("RET",{addressingMode:"C",opCode:[216]}),this.NoAddModes([["RET",201],["RETI",217]])}A_AddressingMode(e,t,s){for(let s=0;s<e.length;++s)this.AddInstruction("LD",{addressingMode:`A,${e[s]}`,opCode:[,t[s]]});for(let t=0;t<e.length;++t)this.AddInstruction("LD",{addressingMode:`${e[t]},A`,opCode:[,s[t]]})}StartToA(e,t,s){const n=["B","C","D","E","H","L","(HL)","A","#[exp]"];for(let i=0;i<n.length;++i)i!==n.length-1?this.AddInstruction(e,{addressingMode:`A,${n[i]}`,opCode:[t++]}):void 0!==s&&this.AddInstruction(e,{addressingMode:"A,#[exp]",opCode:[,s]})}OpCodeOneIncrement(e,t,s){const n=["B","C","D","E","H","L","(HL)","A","#[exp]"];for(let i=0;i<n.length;++i)i!==n.length-1?this.AddInstruction(e,{addressingMode:n[i],opCode:[t++]}):void 0!==s&&this.AddInstruction(e,{addressingMode:"#[exp]",opCode:[,s]})}OpCodeTwoIncrement(e){const t=["B","C","D","E","H","L","(HL)","A"];for(let s=0;s<e.length;++s){let n=e[s][1];for(let i=0;i<t.length;++i)this.AddInstruction(e[s][0],{addressingMode:t[i],opCode:[n],opCodeLength:[2]}),n+=256}}Combine(e,t,s,n){for(let i=0;i<s.length;++i)this.AddInstruction(e,{addressingMode:`${t},${s[i]}`,opCode:[n[i]]})}Single(e,t,s){for(let n=0;n<t.length;++n)this.AddInstruction(e,{addressingMode:t[n],opCode:[s[n]]})}NoAddModes(e){for(let t=0;t<e.length;++t)this.AddInstruction(e[t][0],{opCode:[e[t][1]]})}AddInstruction(e,t){n.Platform.AddInstructionWithLength(e,t)}}},74:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Platform=void 0;const n=s(642),i=s(366),o=s(521),r=s(532),a=s(293),d=s(163),l=s(335),c=s(258);class p{get name(){return p.asmPlatform.platformName}static SwitchPlatform(e){let t;switch(p.instructions.clear(),e){case"6502":t=a.Asm6502;break;case"SPC700":t=l.AsmSPC700;break;case"65c816":t=d.Asm65C816;break;case"z80-gb":t=c.AsmZ80_GB;break;default:let s=o.Localization.GetMessage("Unsupport platform {0}",e);throw new Error(s)}p.asmPlatform=new t,r.IntellisenseProvider.UpdateInstruction()}static AddInstruction(e,t){e=e.toUpperCase();let s=p.instructions.get(e);s||(s=[],p.instructions.set(e,s));let n={addressingMode:t.addressingMode,addressType:[],opCode:[],opCodeLength:[]};if(t.addressingMode){let e,s,o=0,r=[],a=/\[exp\]/g;for(;e=a.exec(t.addressingMode);)s=t.addressingMode.substring(o,e.index).trim(),s&&r.push(i.Utils.TransformRegex(s)),r.push(""),o=e.index+e[0].length;s=t.addressingMode.substring(o).trim(),s&&r.push(i.Utils.TransformRegex(s)),1!==r.length&&(r[0]="^"+r[0]),r[r.length-1]=r[r.length-1]+"$",n.addressType=r}if(n.opCode=t.opCode,n.spProcess=t.spProcess,t.opCodeLength)n.opCodeLength=t.opCodeLength;else for(let e=0;e<n.opCode.length;++e)void 0!==n.opCode[e]&&(n.opCodeLength[e]=i.Utils.GetNumberByteLength(n.opCode[e]));s.push(n)}static AddInstructionWithLength(e,t){if(p.AddInstruction(e,t),!(t.opCode.filter((e=>void 0!==e)).length<2))for(let s=1;s<t.opCode.length;s++){let n=t.opCode[s];if(void 0===n)continue;let i=[];i.length=s+1,i[s]=n,p.AddInstruction(`${e}.${s}`,{addressingMode:t.addressingMode,opCode:i})}}static MatchAddressingMode(e,t){let s=p.instructions.get(e.text.toUpperCase());if(!s){let t=o.Localization.GetMessage("Unknow instruction {0}",e.text);return void n.MyDiagnostic.PushException(e,t)}let i={addressingMode:{},exprs:[]},r=0,a=!1;for(let e=0;e<s.length;++e){const n=s[e];if(i.exprs=[],a=!1,t.isEmpty){if(0===n.addressType.length){a=!0,i.addressingMode=n;break}}else{if(0===n.addressType.length)continue;let e=t.text;r=0,a=!0;for(let s=0;s<n.addressType.length;++s){if(""===n.addressType[s])continue;const o=new RegExp(n.addressType[s],"i").exec(e);if(!o){a=!1;break}const d=t.Substring(r,o.index);n.addressType[s].startsWith("^")||i.exprs.push(d),r+=o.index+o[0].length,e=e.substring(r)}if(a){i.addressingMode=n;break}}}if(a){for(let e=0;e<i.exprs.length;++e)if(i.exprs[e].isEmpty){let t=o.Localization.GetMessage("Expression error");return void n.MyDiagnostic.PushException(i.exprs[e],t)}return i}{let t=o.Localization.GetMessage("Instruction {0} do not support this addressing mode",e.text);n.MyDiagnostic.PushException(e,t)}}static MatchLinePosition(e,t,s){e=e.toUpperCase();const n=p.instructions.get(e);if(!n)return!1;for(let e=0;e<n.length;e++){let i=n[e].addressType,o=[];for(let e=0;e<i.length;e++){if(""===i[e])continue;let n=new RegExp(i[e],"i").exec(t);if(!n){o=[];break}if(0!==n[0].length&&n.index<=s&&s<=n.index+n[0].length-1)return!0}}}}t.Platform=p,p.instructions=new Map}},t={};function s(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,s),o.exports}var n={};(()=>{var e=n;e.ZGAssembler=void 0;const t=s(735),i=s(738),o=s(581),r=s(828),a=s(200),d=s(642),l=s(126),c=s(521),p=s(698),m=s(963),h=s(532),u=s(74),g=s(958),C=s(422),x=s(481),f=s(231),L=s(538);e.ZGAssembler=class{constructor(){this.config=o.Config,this.diagnostic=d.MyDiagnostic,this.fileUtils=a.FileUtils,this.compiler=i.Compiler,this.localization=c.Localization,this.languageHelper={highlighting:m.HighlightingProvider,documentChange:p.DocumentChangeProvider,intellisense:h.IntellisenseProvider,definition:C.DefinitionProvider,renameAndReferences:x.RenameAndReferences,hover:f.HoverProvider,debug:L.DebugProvider},r.ExpressionUtils.Initialize(),u.Platform.SwitchPlatform("6502"),l.Command.Initialize()}async ParseText(e){if(i.Compiler.isCompiling)return;i.Compiler.isCompiling=!0,i.Compiler.ChangeEnv("edit");const s=new t.CompileOption,n=[];for(let t=0;t<e.length;t++)i.Compiler.enviroment.fileIndex=i.Compiler.enviroment.GetFileIndex(e[t].filePath),n.push(i.Compiler.enviroment.fileIndex),d.MyDiagnostic.ClearFileExceptions(i.Compiler.enviroment.fileIndex),i.Compiler.enviroment.ClearFile(i.Compiler.enviroment.fileIndex),g.Analyser.AnalyseText(e[t].text,e[t].filePath);for(const e of n)i.Compiler.enviroment.fileIndex=e,s.allLines=i.Compiler.enviroment.allLine.get(e),await g.Analyser.AnalyseFirst(s);for(const e of n)i.Compiler.enviroment.fileIndex=e,s.allLines=i.Compiler.enviroment.allLine.get(e),await g.Analyser.AnalyseSecond(s);for(const e of n)i.Compiler.enviroment.fileIndex=e,s.allLines=i.Compiler.enviroment.allLine.get(e),await g.Analyser.AnalyseThird(s);i.Compiler.isCompiling=!1}async CompileText(e,s){if(i.Compiler.isCompiling)return;i.Compiler.isCompiling=!0,i.Compiler.stopCompiling=!1,i.Compiler.ChangeEnv("compile"),i.Compiler.enviroment.compileTime=0,i.Compiler.enviroment.fileIndex=i.Compiler.enviroment.GetFileIndex(s),d.MyDiagnostic.ClearAll(),i.Compiler.enviroment.ClearAll();const n=new t.CompileOption;for(n.allLines=g.Analyser.AnalyseText(e,s);await i.Compiler.Compile(n),!(++i.Compiler.enviroment.compileTime>=o.Config.ProjectSetting.compileTimes););if(!i.Compiler.stopCompiling)return this.GetAllResult(n);i.Compiler.isCompiling=!1}SwitchPlatform(e){u.Platform.SwitchPlatform(e)}SwitchLanguage(e){c.Localization.ChangeLanguage(e)}ClearFile(e){const t=i.Compiler.enviroment.GetFileIndex(e);i.Compiler.enviroment.ClearFile(t)}GetAllResult(e){const t=[];i.Compiler.GetLinesResult(e,t),i.Compiler.enviroment.compileResult.finished=!0;const s=new Int16Array(t.length);for(let e=0;e<t.length;e++)s[e]=void 0!==t[e]?255&t[e]:-1;return i.Compiler.isCompiling=!1,s}}})(),zgassembler=n.ZGAssembler})();
//# sourceMappingURL=core-cs-0.3.15.js.map